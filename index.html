<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç ”ç¿’æ™‚ç¨‹è¡¨æ™ºèƒ½åŒ¯å…¥å·¥å…· (è©³ç›¡LINEç‰ˆ) | Workshop Calendar Helper</title>
    
    <!-- å¼•å…¥ SheetJS è™•ç† Excel æª”æ¡ˆ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <!-- å¼•å…¥ PDF.js è™•ç† PDF æª”æ¡ˆ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    
    <!-- å¼•å…¥ Google API Client Library -->
    <script src="https://apis.google.com/js/api.js"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', 'Microsoft JhengHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.98);
            border-radius: 24px;
            box-shadow: 0 20px 80px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 50px 40px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: pulse 15s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.5; }
            50% { transform: scale(1.2); opacity: 0.8; }
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
            position: relative;
            z-index: 1;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 12px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }

        .header p {
            font-size: 1.15em;
            opacity: 0.95;
        }

        .help-button {
            background: rgba(255,255,255,0.2);
            border: 2px solid white;
            color: white;
            padding: 12px 25px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            transition: all 0.3s;
            white-space: nowrap;
        }

        .help-button:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }

        .content {
            padding: 40px;
        }

        .section {
            margin-bottom: 35px;
            animation: fadeInUp 0.6s ease-out;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .section-title {
            font-size: 1.4em;
            color: #667eea;
            margin-bottom: 20px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .section-title::before {
            content: '';
            width: 5px;
            height: 28px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 3px;
        }

        .input-group {
            margin-bottom: 25px;
        }

        .input-group label {
            display: block;
            margin-bottom: 10px;
            color: #333;
            font-weight: 600;
            font-size: 1.05em;
        }

        .input-group small {
            display: block;
            color: #666;
            margin-top: 8px;
            font-size: 0.9em;
        }

        .input-group input[type="text"],
        .input-group input[type="password"],
        .input-group textarea,
        .input-group select {
            width: 100%;
            padding: 14px 18px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 1em;
            transition: all 0.3s;
            font-family: inherit;
            background: white;
        }

        .input-group input:focus,
        .input-group textarea:focus,
        .input-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
        }

        .input-group textarea {
            min-height: 180px;
            resize: vertical;
            line-height: 1.6;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            border-bottom: 2px solid #e0e0e0;
            flex-wrap: wrap;
        }

        .tab {
            padding: 12px 20px;
            border: none;
            background: transparent;
            color: #666;
            font-size: 1.05em;
            font-weight: 600;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
            position: relative;
            top: 2px;
            white-space: nowrap;
        }

        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .tab:hover {
            color: #667eea;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.4s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .file-upload {
            border: 3px dashed #667eea;
            border-radius: 16px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: rgba(102, 126, 234, 0.05);
        }

        .file-upload:hover {
            background: rgba(102, 126, 234, 0.12);
            border-color: #764ba2;
            transform: scale(1.02);
        }

        .file-upload input[type="file"] {
            display: none;
        }

        .file-upload-icon {
            font-size: 4em;
            margin-bottom: 15px;
        }

        .file-upload-text {
            font-size: 1.1em;
            color: #667eea;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .file-upload-hint {
            font-size: 0.9em;
            color: #999;
            line-height: 1.6;
        }

        .format-hint {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.08), rgba(118, 75, 162, 0.08));
            padding: 15px 18px;
            border-radius: 10px;
            margin-bottom: 15px;
            font-size: 0.95em;
            border-left: 4px solid #667eea;
            line-height: 1.6;
        }

        .btn {
            width: 100%;
            padding: 18px 30px;
            font-size: 1.15em;
            font-weight: 600;
            border: none;
            border-radius: 14px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.35);
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 35px rgba(102, 126, 234, 0.45);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #2e7d32 0%, #388e3c 100%);
            color: white;
            box-shadow: 0 8px 25px rgba(46, 125, 50, 0.35);
        }

        .btn-secondary:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 35px rgba(46, 125, 50, 0.45);
        }

        .btn-clear-key {
            background: #f44336;
            color: white;
            border: none;
            padding: 14px 18px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s;
            white-space: nowrap;
        }

        .btn-clear-key:hover {
            background: #d32f2f;
            transform: translateY(-2px);
        }

        .reminder-options {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 12px;
        }

        .checkbox-option {
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 12px;
            transition: all 0.3s;
            cursor: pointer;
        }

        .checkbox-option:hover {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.05);
        }

        .checkbox-option.checked {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.1);
        }

        .checkbox-option input[type="checkbox"] {
            margin-right: 8px;
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .checkbox-option label {
            cursor: pointer;
            font-size: 1em;
        }

        .status-message {
            padding: 15px 20px;
            border-radius: 12px;
            margin: 20px 0;
            font-weight: 500;
            display: none;
            animation: slideIn 0.4s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .status-message.info {
            background: #e3f2fd;
            color: #1565c0;
            border-left: 4px solid #1976d2;
        }

        .status-message.success {
            background: #e8f5e9;
            color: #2e7d32;
            border-left: 4px solid #4caf50;
        }

        .status-message.error {
            background: #ffebee;
            color: #c62828;
            border-left: 4px solid #f44336;
        }

        .status-message.warning {
            background: #fff3e0;
            color: #e65100;
            border-left: 4px solid #ff9800;
        }

        .events-preview {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 25px;
            margin-top: 25px;
            display: none;
        }

        .events-preview.show {
            display: block;
            animation: fadeIn 0.5s ease-out;
        }

        .event-item {
            background: white;
            padding: 18px;
            border-radius: 10px;
            margin-bottom: 15px;
            border-left: 4px solid #667eea;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        .event-title {
            font-weight: 600;
            color: #333;
            font-size: 1.1em;
            margin-bottom: 8px;
        }

        .event-time {
            color: #666;
            font-size: 0.95em;
            margin-bottom: 5px;
        }

        .event-location {
            color: #667eea;
            font-size: 0.9em;
        }

        .event-time-block {
            margin: 10px 0;
        }

        .event-date {
            color: #444;
            font-size: 1em;
            margin-bottom: 6px;
            font-weight: 500;
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 8px;
        }

        .day-badge {
            display: inline-block;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 3px 12px;
            border-radius: 6px;
            font-size: 0.85em;
            font-weight: 600;
            box-shadow: 0 2px 6px rgba(102, 126, 234, 0.3);
        }

        .additional-notes-section {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 2px dashed #e0e0e0;
        }

        .additional-notes-label {
            display: block;
            font-weight: 600;
            color: #667eea;
            margin-bottom: 8px;
            font-size: 1em;
        }

        .optional-hint {
            color: #999;
            font-size: 0.85em;
            font-weight: 400;
            margin-left: 5px;
        }

        .additional-notes-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 0.95em;
            font-family: inherit;
            resize: vertical;
            transition: all 0.3s;
            background: #fafafa;
        }

        .additional-notes-input:focus {
            outline: none;
            border-color: #667eea;
            background: white;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .additional-notes-input::placeholder {
            color: #aaa;
        }

        .btn-delete-event {
            background: white;
            color: #f44336;
            border: 2px solid #f44336;
            border-radius: 8px;
            padding: 6px 14px;
            font-size: 0.9em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            white-space: nowrap;
            flex-shrink: 0;
            margin-left: 10px;
        }

        .btn-delete-event:hover {
            background: #f44336;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(244, 67, 54, 0.3);
        }

        .btn-delete-event:active {
            transform: translateY(0);
        }

        .event-item.deleted {
            opacity: 0.4;
            position: relative;
        }

        .event-item.deleted::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 3px;
            background: #f44336;
            transform: translateY(-50%);
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .file-count-badge {
            display: inline-block;
            background: #4caf50;
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: 600;
            margin-left: 10px;
        }

        /* å¹«åŠ©ä¸­å¿ƒæ¨¡æ…‹è¦–çª— */
        .help-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 999999;
            overflow-y: auto;
        }
        
        .help-modal.show {
            display: flex !important;
        }
        
        .help-modal-content {
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            border: 3px solid #667eea;
            border-radius: 20px;
            max-width: 900px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            padding: 40px;
            color: white;
            margin: 20px;
        }
        
        .help-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }
        
        .help-modal h2 {
            color: white;
            font-size: 2em;
        }
        
        .close-button {
            width: 40px;
            height: 40px;
            background: rgba(255, 0, 0, 0.2);
            border: 2px solid #ff0000;
            border-radius: 50%;
            color: #ff0000;
            font-size: 1.5em;
            cursor: pointer;
            transition: all 0.3s;
            flex-shrink: 0;
        }
        
        .close-button:hover {
            background: rgba(255, 0, 0, 0.4);
            transform: rotate(90deg);
        }

        .help-tabs-container {
            margin-bottom: 30px;
            border-bottom: 2px solid rgba(102, 126, 234, 0.3);
        }

        .help-tabs {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
        }

        .help-tab {
            padding: 12px 20px;
            background: rgba(102, 126, 234, 0.1);
            border: none;
            border-radius: 10px 10px 0 0;
            color: rgba(255, 255, 255, 0.7);
            cursor: pointer;
            font-size: 0.95em;
            font-weight: 600;
            transition: all 0.3s;
            white-space: nowrap;
        }

        .help-tab.active {
            background: rgba(102, 126, 234, 0.3);
            color: white;
            border-bottom: 3px solid #667eea;
        }

        .help-tab:hover {
            background: rgba(102, 126, 234, 0.2);
            color: white;
        }

        .help-tab-content {
            display: none;
        }

        .help-tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease-out;
        }

        .help-content h3 {
            color: #667eea;
            margin: 25px 0 15px 0;
            font-size: 1.3em;
        }

        .help-content h4 {
            color: #88a3f5;
            margin: 20px 0 10px 0;
            font-size: 1.1em;
        }

        .help-content p {
            line-height: 1.8;
            margin: 10px 0;
            color: rgba(255, 255, 255, 0.9);
        }

        .help-content ul, .help-content ol {
            margin: 10px 0 10px 20px;
            line-height: 1.8;
        }

        .help-content li {
            margin: 8px 0;
            color: rgba(255, 255, 255, 0.85);
        }

        .help-content code {
            background: rgba(102, 126, 234, 0.2);
            padding: 2px 8px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            color: #a8d5ff;
            font-size: 0.9em;
        }

        .help-content pre {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(102, 126, 234, 0.3);
            border-radius: 8px;
            padding: 15px;
            overflow-x: auto;
            margin: 15px 0;
        }

        .help-content pre code {
            background: none;
            padding: 0;
            color: #a8d5ff;
            font-size: 0.85em;
            line-height: 1.6;
        }

        .warning-box {
            background: rgba(255, 152, 0, 0.15);
            border-left: 4px solid #ff9800;
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
        }

        .warning-box strong {
            color: #ffa726;
        }

        .info-box {
            background: rgba(33, 150, 243, 0.15);
            border-left: 4px solid #2196f3;
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
        }

        .info-box strong {
            color: #64b5f6;
        }

        .success-box {
            background: rgba(76, 175, 80, 0.15);
            border-left: 4px solid #4caf50;
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
        }

        .success-box strong {
            color: #81c784;
        }

        .step-box {
            background: rgba(102, 126, 234, 0.1);
            border: 2px solid rgba(102, 126, 234, 0.3);
            padding: 20px;
            margin: 15px 0;
            border-radius: 12px;
        }

        .step-number {
            display: inline-block;
            background: #667eea;
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            text-align: center;
            line-height: 32px;
            font-weight: bold;
            margin-right: 10px;
        }

        /* æ¨¡æ…‹è¦–çª— */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }

        .modal-overlay.show .modal-content {
            transform: scale(1);
        }

        .modal-icon {
            font-size: 4em;
            text-align: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 2em;
            font-weight: 700;
            text-align: center;
            margin-bottom: 15px;
        }

        .modal-message {
            font-size: 1.1em;
            text-align: center;
            color: #666;
            margin-bottom: 25px;
            line-height: 1.6;
        }

        .result-details {
            max-height: 300px;
            overflow-y: auto;
            margin: 20px 0;
        }

        .result-item {
            padding: 10px 15px;
            margin: 8px 0;
            border-radius: 8px;
            font-size: 0.95em;
        }

        .result-success {
            background: #e8f5e9;
            color: #2e7d32;
            border-left: 4px solid #4caf50;
        }

        .result-fail {
            background: #ffebee;
            color: #c62828;
            border-left: 4px solid #f44336;
        }

        .modal-btn {
            padding: 14px 28px;
            border: none;
            border-radius: 10px;
            font-size: 1.05em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .modal-btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .modal-btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }

        .modal-btn-secondary {
            background: #e0e0e0;
            color: #333;
        }

        .modal-btn-secondary:hover {
            background: #d0d0d0;
            transform: translateY(-2px);
        }

        .footer {
            text-align: center;
            padding: 30px 40px;
            background: #f8f9fa;
            color: #666;
            font-size: 0.95em;
        }

        .footer p {
            margin: 5px 0;
        }

        .api-key-hint {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.08), rgba(118, 75, 162, 0.08));
            padding: 12px 15px;
            border-radius: 10px;
            margin-top: 15px;
            font-size: 0.95em;
            border-left: 4px solid #667eea;
        }

        .api-key-hint a {
            color: #667eea;
            text-decoration: none;
            font-weight: 600;
        }

        .api-key-hint a:hover {
            text-decoration: underline;
        }

        .ocr-tips {
            background: #fff3e0;
            border-left: 4px solid #ff9800;
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
        }

        .ocr-tips strong {
            color: #e65100;
            display: block;
            margin-bottom: 10px;
        }

        .ocr-tips-item {
            margin: 6px 0;
            padding-left: 8px;
            color: #5d4037;
            line-height: 1.6;
        }

        .preview-image {
            max-width: 100%;
            border-radius: 12px;
            margin-top: 15px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        /* æœ¬æ©Ÿå„²å­˜è­¦å‘Š */
        .storage-warning {
            background: rgba(244, 67, 54, 0.1);
            border: 2px solid #f44336;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }

        .storage-warning h4 {
            color: #f44336;
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        .storage-warning ul {
            margin: 10px 0 10px 20px;
            color: #c62828;
        }

        .storage-warning li {
            margin: 5px 0;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2em;
            }

            .header p {
                font-size: 1em;
            }

            .content {
                padding: 25px;
            }

            .tabs {
                gap: 5px;
            }

            .tab {
                padding: 10px 15px;
                font-size: 0.95em;
            }

            .reminder-options {
                grid-template-columns: 1fr;
            }

            .help-modal-content {
                padding: 25px;
            }

            .help-tabs {
                gap: 3px;
            }

            .help-tab {
                padding: 10px 12px;
                font-size: 0.85em;
            }

            .auth-digits {
                gap: 5px;
            }

            .auth-digit {
                width: 40px;
                height: 50px;
                font-size: 1.5em;
            }
        }

        /* ============================================
           ğŸš€ é…·ç‚«ç§‘æŠ€é¢¨é–‹æ©Ÿå‹•ç•« Splash Screen
           ============================================ */
        .splash-screen {
            position: fixed;
            inset: 0;
            background: radial-gradient(ellipse at center, #1a1a2e 0%, #0f0f1a 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 99999;
            overflow: hidden;
            transition: opacity 0.8s ease, visibility 0.8s ease;
        }

        .splash-screen.hide {
            opacity: 0;
            visibility: hidden;
        }

        /* èƒŒæ™¯ç¶²æ ¼å‹•ç•« */
        .splash-grid {
            position: absolute;
            inset: 0;
            background-image: 
                linear-gradient(rgba(102, 126, 234, 0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(102, 126, 234, 0.05) 1px, transparent 1px);
            background-size: 40px 40px;
            animation: gridPulse 4s ease-in-out infinite;
        }

        @keyframes gridPulse {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 0.6; }
        }

        /* é£„æµ®ç²’å­ */
        .splash-particles {
            position: absolute;
            inset: 0;
            overflow: hidden;
        }

        .splash-particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: #667eea;
            border-radius: 50%;
            box-shadow: 0 0 10px #667eea, 0 0 20px #667eea;
            animation: particleRise 6s ease-in-out infinite;
        }

        .splash-particle:nth-child(1) { left: 10%; animation-delay: 0s; }
        .splash-particle:nth-child(2) { left: 20%; animation-delay: 1s; background: #764ba2; box-shadow: 0 0 10px #764ba2; }
        .splash-particle:nth-child(3) { left: 30%; animation-delay: 2s; }
        .splash-particle:nth-child(4) { left: 40%; animation-delay: 0.5s; background: #a855f7; box-shadow: 0 0 10px #a855f7; }
        .splash-particle:nth-child(5) { left: 50%; animation-delay: 1.5s; }
        .splash-particle:nth-child(6) { left: 60%; animation-delay: 2.5s; background: #764ba2; box-shadow: 0 0 10px #764ba2; }
        .splash-particle:nth-child(7) { left: 70%; animation-delay: 0.8s; }
        .splash-particle:nth-child(8) { left: 80%; animation-delay: 1.8s; background: #a855f7; box-shadow: 0 0 10px #a855f7; }
        .splash-particle:nth-child(9) { left: 90%; animation-delay: 2.8s; }

        @keyframes particleRise {
            0% { transform: translateY(100vh) scale(0); opacity: 0; }
            10% { opacity: 1; transform: scale(1); }
            90% { opacity: 1; }
            100% { transform: translateY(-100vh) scale(0.5); opacity: 0; }
        }

        /* Logo å®¹å™¨ */
        .splash-logo-container {
            position: relative;
            width: 180px;
            height: 180px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 40px;
        }

        /* å¤–å±¤æ—‹è½‰ç’° */
        .splash-ring {
            position: absolute;
            border: 3px solid transparent;
            border-radius: 50%;
            animation: ringRotate linear infinite;
        }

        .splash-ring-1 {
            width: 180px;
            height: 180px;
            border-top-color: #667eea;
            border-right-color: #667eea;
            animation-duration: 3s;
            filter: drop-shadow(0 0 8px #667eea);
        }

        .splash-ring-2 {
            width: 150px;
            height: 150px;
            border-bottom-color: #764ba2;
            border-left-color: #764ba2;
            animation-duration: 2.5s;
            animation-direction: reverse;
            filter: drop-shadow(0 0 8px #764ba2);
        }

        .splash-ring-3 {
            width: 120px;
            height: 120px;
            border-top-color: #a855f7;
            animation-duration: 2s;
            filter: drop-shadow(0 0 8px #a855f7);
        }

        @keyframes ringRotate {
            to { transform: rotate(360deg); }
        }

        /* ä¸­å¿ƒ Logo */
        .splash-logo-inner {
            width: 90px;
            height: 90px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 22px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            animation: logoSpin 2s ease-in-out, logoPulse 2s ease-in-out infinite 2s;
            box-shadow: 0 0 40px rgba(102, 126, 234, 0.6);
            z-index: 10;
        }

        @keyframes logoSpin {
            0% { transform: rotateY(0deg) scale(0.3); opacity: 0; }
            50% { transform: rotateY(180deg) scale(1.1); }
            100% { transform: rotateY(360deg) scale(1); opacity: 1; }
        }

        @keyframes logoPulse {
            0%, 100% { box-shadow: 0 0 40px rgba(102, 126, 234, 0.6); }
            50% { box-shadow: 0 0 60px rgba(102, 126, 234, 0.9), 0 0 80px rgba(118, 75, 162, 0.5); }
        }

        /* è»Œé“ç²’å­ */
        .orbit-particle {
            position: absolute;
            width: 8px;
            height: 8px;
            background: #667eea;
            border-radius: 50%;
            box-shadow: 0 0 12px #667eea;
        }

        .orbit-particle:nth-child(1) { animation: orbit1 3s linear infinite; }
        .orbit-particle:nth-child(2) { animation: orbit2 2.5s linear infinite; background: #764ba2; box-shadow: 0 0 12px #764ba2; }
        .orbit-particle:nth-child(3) { animation: orbit3 2s linear infinite; background: #a855f7; box-shadow: 0 0 12px #a855f7; }

        @keyframes orbit1 {
            0% { transform: rotate(0deg) translateX(90px) rotate(0deg); }
            100% { transform: rotate(360deg) translateX(90px) rotate(-360deg); }
        }
        @keyframes orbit2 {
            0% { transform: rotate(120deg) translateX(75px) rotate(-120deg); }
            100% { transform: rotate(480deg) translateX(75px) rotate(-480deg); }
        }
        @keyframes orbit3 {
            0% { transform: rotate(240deg) translateX(60px) rotate(-240deg); }
            100% { transform: rotate(600deg) translateX(60px) rotate(-600deg); }
        }

        /* æ¨™é¡Œæ–‡å­— */
        .splash-title {
            font-size: 28px;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #a855f7 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            opacity: 0;
            animation: textFadeUp 0.8s ease forwards 1s;
            text-align: center;
        }

        .splash-subtitle {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.6);
            margin-top: 12px;
            opacity: 0;
            animation: textFadeUp 0.8s ease forwards 1.3s;
        }

        @keyframes textFadeUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* è¼‰å…¥é€²åº¦æ¢ */
        .splash-progress {
            width: 200px;
            height: 4px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            margin-top: 40px;
            overflow: hidden;
            opacity: 0;
            animation: textFadeUp 0.8s ease forwards 1.6s;
        }

        .splash-progress-bar {
            width: 0%;
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2, #a855f7);
            border-radius: 2px;
            animation: progressFill 2s ease forwards 1.8s;
        }

        @keyframes progressFill {
            0% { width: 0%; }
            100% { width: 100%; }
        }

        /* è¼‰å…¥é»é» */
        .splash-dots {
            display: flex;
            gap: 8px;
            margin-top: 20px;
            opacity: 0;
            animation: textFadeUp 0.8s ease forwards 1.9s;
        }

        .splash-dots span {
            width: 8px;
            height: 8px;
            background: #667eea;
            border-radius: 50%;
            animation: dotBounce 1.4s ease-in-out infinite;
        }

        .splash-dots span:nth-child(2) { animation-delay: 0.2s; background: #764ba2; }
        .splash-dots span:nth-child(3) { animation-delay: 0.4s; background: #a855f7; }

        @keyframes dotBounce {
            0%, 80%, 100% { transform: scale(1); opacity: 0.5; }
            40% { transform: scale(1.3); opacity: 1; }
        }
    </style>
</head>
<body>
    <!-- ğŸš€ é–‹æ©Ÿå‹•ç•« Splash Screen -->
    <div class="splash-screen" id="splashScreen">
        <div class="splash-grid"></div>
        <div class="splash-particles">
            <div class="splash-particle"></div>
            <div class="splash-particle"></div>
            <div class="splash-particle"></div>
            <div class="splash-particle"></div>
            <div class="splash-particle"></div>
            <div class="splash-particle"></div>
            <div class="splash-particle"></div>
            <div class="splash-particle"></div>
            <div class="splash-particle"></div>
        </div>
        <div class="splash-logo-container">
            <div class="splash-ring splash-ring-1"></div>
            <div class="splash-ring splash-ring-2"></div>
            <div class="splash-ring splash-ring-3"></div>
            <div class="splash-logo-inner">ğŸ“…</div>
            <div class="orbit-particle"></div>
            <div class="orbit-particle"></div>
            <div class="orbit-particle"></div>
        </div>
        <div class="splash-title">ç ”ç¿’æ™‚ç¨‹è¡¨æ™ºèƒ½åŒ¯å…¥å·¥å…·</div>
        <div class="splash-subtitle">AI é©…å‹•çš„æ™ºèƒ½ç ”ç¿’ç®¡ç†ç³»çµ±</div>
        <div class="splash-progress">
            <div class="splash-progress-bar"></div>
        </div>
        <div class="splash-dots">
            <span></span>
            <span></span>
            <span></span>
        </div>
    </div>
    <div class="container">
        <div class="header">
            <div class="header-content">
                <div>
                    <h1>ğŸ“… ç ”ç¿’æ™‚ç¨‹è¡¨æ™ºèƒ½åŒ¯å…¥å·¥å…·</h1>
                    <p>AI é©…å‹•çš„æ™ºèƒ½ç ”ç¿’ç®¡ç†ç³»çµ± âš¡ è©³ç›¡ LINE é€šçŸ¥ç‰ˆ (æ”¯æ´æ°‘åœ‹å¹´)</p>
                </div>
                <button class="help-button" onclick="openHelp()">
                    ğŸ“š å¹«åŠ©ä¸­å¿ƒ
                </button>
            </div>
        </div>

        <div class="content">
            <!-- æœ¬æ©Ÿå„²å­˜è¨­å®š -->
            <div class="section">
                <div class="section-title">ğŸ’¾ æœ¬æ©Ÿè‡ªå‹•å„²å­˜è¨­å®š</div>
                
                <div class="storage-warning">
                    <h4>âš ï¸ é‡è¦å®‰å…¨è­¦å‘Š</h4>
                    <ul>
                        <li><strong>æ•æ„Ÿè³‡è¨Šé¢¨éšªï¼š</strong>å•Ÿç”¨æœ¬æ©Ÿå„²å­˜å°‡åœ¨æ‚¨çš„é›»è…¦ä¸­å„²å­˜ API é‡‘é‘°ç­‰æ•æ„Ÿè³‡è¨Š</li>
                        <li><strong>å…±ç”¨é›»è…¦é¢¨éšªï¼š</strong>å¦‚æœä½¿ç”¨å…±ç”¨æˆ–å…¬ç”¨é›»è…¦ï¼Œå…¶ä»–äººå¯èƒ½å­˜å–é€™äº›è³‡è¨Š</li>
                        <li><strong>ç¦æ­¢åˆ†äº«ï¼š</strong>çµ•å°ä¸è¦å°‡å•Ÿç”¨æœ¬æ©Ÿå„²å­˜çš„æ­¤å·¥å…·åˆ†äº«çµ¦ä»–äºº</li>
                        <li><strong>å»ºè­°åšæ³•ï¼š</strong>åƒ…åœ¨å€‹äººç§æœ‰é›»è…¦ä¸Šä½¿ç”¨æ­¤åŠŸèƒ½</li>
                    </ul>
                </div>

                <div class="input-group">
                    <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                        <input type="checkbox" id="enableLocalStorage" onchange="toggleLocalStorage(this)" style="width: 20px; height: 20px;">
                        <span>å•Ÿç”¨æœ¬æ©Ÿè‡ªå‹•å„²å­˜ API é‡‘é‘°ï¼ˆæˆ‘å·²äº†è§£é¢¨éšªï¼‰</span>
                    </label>
                    <small style="color: #f44336; font-weight: 500;">
                        âš ï¸ åƒ…åœ¨æ‚¨å®Œå…¨ä¿¡ä»»æ­¤è£ç½®æ™‚å•Ÿç”¨æ­¤åŠŸèƒ½
                    </small>
                </div>
            </div>

            <!-- API Key è¨­å®š -->
            <div class="section">
                <div class="section-title">ğŸ”‘ API é‡‘é‘°è¨­å®š</div>
                
                <!-- Google OAuth è¨­ç½® -->
                <div class="input-group">
                    <label for="googleClientId">Google OAuth Client IDï¼ˆç”¨æ–¼è‡ªå‹•å„²å­˜è‡³æ—¥æ›†ï¼‰</label>
                    <div style="display: flex; gap: 10px; align-items: stretch;">
                        <div style="flex: 1; position: relative;">
                            <input type="password" id="googleClientId" placeholder="è¼¸å…¥æ‚¨çš„ Google OAuth Client ID" style="width: 100%; padding-right: 45px;">
                            <button type="button" onclick="toggleClientIdVisibility()" style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer; font-size: 1.2em; padding: 5px;" title="é¡¯ç¤º/éš±è—">
                                <span id="clientIdEyeIcon">ğŸ‘ï¸</span>
                            </button>
                        </div>
                        <button class="btn-clear-key" onclick="clearGoogleClientId()" title="æ¸…é™¤ Client ID">
                            ğŸ—‘ï¸ æ¸…é™¤
                        </button>
                    </div>
                    <small style="color: #1976d2; font-weight: 500; display: flex; align-items: flex-start; gap: 5px; margin-top: 8px;">
                        <span>â„¹ï¸</span>
                        <span>è¨­å®šæ•™å­¸è«‹é»æ“Šå³ä¸Šè§’ã€ŒğŸ“š å¹«åŠ©ä¸­å¿ƒã€â†’ã€ŒğŸ” Google OAuthã€</span>
                    </small>
                    <div id="authStatus" style="margin-top: 10px; display: none;"></div>
                    <button id="authorizeButton" class="btn-secondary" style="margin-top: 10px; display: none; width: auto; padding: 10px 20px;" onclick="handleAuthClick()">
                        ğŸ” æˆæ¬Šå­˜å– Google æ—¥æ›†
                    </button>
                </div>
                
                <!-- Gemini API Key -->
                <div class="input-group">
                    <label for="geminiApiKey">
                        Gemini API Key
                        <span style="color: #4caf50; font-size: 0.85em; margin-left: 8px;">ï¼ˆå¯é¸ - ä¸å¡«ä¹Ÿèƒ½ç”¨ï¼‰</span>
                    </label>
                    <div style="display: flex; gap: 10px; align-items: stretch;">
                        <div style="flex: 1; position: relative;">
                            <input type="password" id="geminiApiKey" placeholder="é¸å¡«ï¼šè¼¸å…¥ API Key å¯ä½¿ç”¨ AI æ™ºèƒ½è§£æï¼ˆæ›´æº–ç¢ºï¼‰" style="width: 100%; padding-right: 45px;">
                            <button type="button" onclick="toggleApiKeyVisibility()" style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer; font-size: 1.2em; padding: 5px;" title="é¡¯ç¤º/éš±è—">
                                <span id="eyeIcon">ğŸ‘ï¸</span>
                            </button>
                        </div>
                        <button class="btn-clear-key" onclick="clearApiKey()" title="æ¸…é™¤é‡‘é‘°">
                            ğŸ—‘ï¸ æ¸…é™¤
                        </button>
                    </div>
                    <small style="color: #1976d2; font-weight: 500; display: flex; align-items: center; gap: 5px; margin-top: 8px;">
                        <span>ğŸ’¡</span>
                        <span>è¨­å®šæ•™å­¸è«‹é»æ“Šå³ä¸Šè§’ã€ŒğŸ“š å¹«åŠ©ä¸­å¿ƒã€â†’ã€ŒğŸ¤– Gemini APIã€</span>
                    </small>
                </div>
            </div>

            <!-- LINE é€šçŸ¥è¨­å®š -->
            <div class="section">
                <div class="section-title">
                    ğŸ“± LINE é€šçŸ¥è¨­å®š
                    <span style="font-size: 0.7em; color: #4caf50; margin-left: 10px;">âš¡ è©³ç›¡ç‰ˆ v2.0</span>
                </div>
                
                <!-- LINE Bot Token -->
                <div class="input-group">
                    <label for="lineChannelAccessToken">LINE Channel Access Token</label>
                    <div style="display: flex; gap: 10px; align-items: stretch;">
                        <div style="flex: 1; position: relative;">
                            <input type="password" id="lineChannelAccessToken" placeholder="è¼¸å…¥æ‚¨çš„ LINE Channel Access Token" style="width: 100%; padding-right: 45px;">
                            <button type="button" onclick="toggleLineTokenVisibility()" style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer; font-size: 1.2em; padding: 5px;" title="é¡¯ç¤º/éš±è—">
                                <span id="lineTokenEyeIcon">ğŸ‘ï¸</span>
                            </button>
                        </div>
                        <button class="btn-clear-key" onclick="clearLineToken()" title="æ¸…é™¤ Token">
                            ğŸ—‘ï¸ æ¸…é™¤
                        </button>
                    </div>
                </div>

                <!-- LINE User ID -->
                <div class="input-group">
                    <label for="lineUserId">æ‚¨çš„ LINE User ID</label>
                    <div style="display: flex; gap: 10px; align-items: stretch;">
                        <div style="flex: 1; position: relative;">
                            <input type="password" id="lineUserId" placeholder="è¼¸å…¥æ‚¨çš„ LINE User IDï¼ˆä¾‹å¦‚ï¼šU1234567890abcdef...ï¼‰" style="width: 100%; padding-right: 45px;">
                            <button type="button" onclick="toggleLineUserIdVisibility()" style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer; font-size: 1.2em; padding: 5px;" title="é¡¯ç¤º/éš±è—">
                                <span id="lineUserIdEyeIcon">ğŸ‘ï¸</span>
                            </button>
                        </div>
                        <button class="btn-clear-key" onclick="clearLineUserId()" title="æ¸…é™¤ User ID">
                            ğŸ—‘ï¸ æ¸…é™¤
                        </button>
                    </div>
                </div>

                <!-- Google Apps Script URL -->
                <div class="input-group">
                    <label for="gasWebAppUrl">Google Apps Script ç¶²å€</label>
                    <div style="display: flex; gap: 10px; align-items: stretch;">
                        <div style="flex: 1; position: relative;">
                            <input type="password" id="gasWebAppUrl" placeholder="è¼¸å…¥æ‚¨éƒ¨ç½²çš„ GAS Web App URL" style="width: 100%; padding-right: 45px;">
                            <button type="button" onclick="toggleGasUrlVisibility()" style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer; font-size: 1.2em; padding: 5px;" title="é¡¯ç¤º/éš±è—">
                                <span id="gasUrlEyeIcon">ğŸ‘ï¸</span>
                            </button>
                        </div>
                        <button class="btn-clear-key" onclick="clearGasUrl()" title="æ¸…é™¤ç¶²å€">
                            ğŸ—‘ï¸ æ¸…é™¤
                        </button>
                    </div>
                    
                    <label for="gasSecretKey" style="margin-top: 20px; display: block;">ğŸ” å®‰å…¨é‡‘é‘° (Secret Key)</label>
                    <div style="display: flex; gap: 10px; align-items: stretch;">
                        <div style="flex: 1; position: relative;">
                            <input type="password" id="gasSecretKey" placeholder="è¼¸å…¥ GAS ä¸­è¨­å®šçš„ SECURITY_SECRET" style="width: 100%; padding-right: 45px;">
                            <button type="button" onclick="toggleSecretKeyVisibility()" style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer; font-size: 1.2em; padding: 5px;" title="é¡¯ç¤º/éš±è—">
                                <span id="secretKeyEyeIcon">ğŸ‘ï¸</span>
                            </button>
                        </div>
                        <button class="btn-clear-key" onclick="clearSecretKey()" title="æ¸…é™¤é‡‘é‘°">
                            ğŸ—‘ï¸ æ¸…é™¤
                        </button>
                    </div>
                    <small style="color: #1976d2; font-weight: 500; display: flex; align-items: flex-start; gap: 5px; margin-top: 8px;">
                        <span>â„¹ï¸</span>
                        <span>å®Œæ•´è¨­å®šæ•™å­¸è«‹é»æ“Šå³ä¸Šè§’ã€ŒğŸ“š å¹«åŠ©ä¸­å¿ƒã€â†’ã€ŒğŸ“± LINE è¨­å®šã€</span>
                    </small>
                    
                    <!-- è©³ç›¡ç‰ˆåŠŸèƒ½èªªæ˜ -->
                    <div style="margin-top: 15px; padding: 12px; background: linear-gradient(135deg, #e8f5e9 0%, #f1f8e9 100%); border-left: 4px solid #4caf50; border-radius: 8px;">
                        <div style="font-weight: bold; color: #2e7d32; margin-bottom: 8px; display: flex; align-items: center; gap: 8px;">
                            <span>âš¡</span>
                            <span>è©³ç›¡ç‰ˆ LINE é€šçŸ¥ç‰¹è‰²</span>
                        </div>
                        <div style="font-size: 0.9em; color: #558b2f; line-height: 1.6;">
                            âœ… è‡ªå‹•è¨ˆç®—ç ”ç¿’æ™‚é•·<br>
                            âœ… æ™ºèƒ½å€’æ•¸æé†’ (ä»Šå¤©/æ˜å¤©/Xå¤©å¾Œ)<br>
                            âœ… çµ±è¨ˆç¸½å ´æ¬¡èˆ‡ç¸½æ™‚æ•¸<br>
                            âœ… ç¾è§€æ¡†ç·šèˆ‡åˆ†å±¤çµæ§‹<br>
                            âœ… å®Œæ•´è¬›å¸«èˆ‡èª²ç¨‹è³‡è¨Š
                        </div>
                    </div>
                </div>

                <!-- æ¸¬è©¦æŒ‰éˆ• -->
                <div style="display: flex; gap: 10px; margin-top: 15px;">
                    <button class="btn-secondary" onclick="testLineNotification()" style="flex: 1;">
                        ğŸ“¨ æ¸¬è©¦ LINE é€šçŸ¥
                    </button>
                </div>

                <!-- LINE é€šçŸ¥é¸é … -->
                <div class="input-group" style="margin-top: 20px;">
                    <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                        <input type="checkbox" id="autoSendToLine" onchange="updateLineSendOption(this)" style="width: 20px; height: 20px;">
                        <span>è§£æå®Œæˆå¾Œè‡ªå‹•ç™¼é€åˆ° LINE</span>
                    </label>
                </div>
                
                <!-- ğŸ”” ç ”ç¿’æé†’æ’ç¨‹è¨­å®š -->
                <div class="input-group" style="margin-top: 25px; padding-top: 20px; border-top: 2px dashed #e0e0e0;">
                    <label style="display: block; font-weight: 600; color: #667eea; margin-bottom: 15px; font-size: 1.1em;">
                        ğŸ”” ç ”ç¿’æå‰æé†’è¨­å®š
                        <span style="font-weight: normal; font-size: 0.85em; color: #888; display: block; margin-top: 5px;">
                            å‹¾é¸å¾Œï¼Œç³»çµ±æœƒåœ¨ç ”ç¿’é–‹å§‹å‰è‡ªå‹•ç™¼é€ LINE æé†’
                        </span>
                    </label>
                    
                    <!-- æé†’æ™‚é–“é¸é … -->
                    <div style="display: flex; flex-direction: column; gap: 12px; margin-bottom: 15px;">
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; padding: 12px 15px; background: #f8f9fa; border-radius: 10px; transition: all 0.2s;">
                            <input type="checkbox" id="reminder1Day" onchange="saveReminderSettings()" style="width: 18px; height: 18px; accent-color: #667eea;">
                            <span style="flex: 1;">ğŸ“… ç ”ç¿’å‰ <strong style="color: #667eea;">1 å¤©</strong> æé†’</span>
                            <span style="font-size: 0.85em; color: #888;">å‰ä¸€å¤©åŒæ™‚é–“</span>
                        </label>
                        
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; padding: 12px 15px; background: #f8f9fa; border-radius: 10px; transition: all 0.2s;">
                            <input type="checkbox" id="reminder2Hours" onchange="saveReminderSettings()" style="width: 18px; height: 18px; accent-color: #667eea;">
                            <span style="flex: 1;">â° ç ”ç¿’å‰ <strong style="color: #667eea;">2 å°æ™‚</strong> æé†’</span>
                            <span style="font-size: 0.85em; color: #888;">å……è¶³æº–å‚™æ™‚é–“</span>
                        </label>
                        
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; padding: 12px 15px; background: #f8f9fa; border-radius: 10px; transition: all 0.2s;">
                            <input type="checkbox" id="reminder1Hour" onchange="saveReminderSettings()" style="width: 18px; height: 18px; accent-color: #667eea;">
                            <span style="flex: 1;">âš¡ ç ”ç¿’å‰ <strong style="color: #667eea;">1 å°æ™‚</strong> æé†’</span>
                            <span style="font-size: 0.85em; color: #888;">æœ€å¾Œç¢ºèª</span>
                        </label>
                        
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; padding: 12px 15px; background: #f8f9fa; border-radius: 10px; transition: all 0.2s;">
                            <input type="checkbox" id="reminder30Min" onchange="saveReminderSettings()" style="width: 18px; height: 18px; accent-color: #667eea;">
                            <span style="flex: 1;">ğŸš€ ç ”ç¿’å‰ <strong style="color: #667eea;">30 åˆ†é˜</strong> æé†’</span>
                            <span style="font-size: 0.85em; color: #888;">å³æ™‚æé†’</span>
                        </label>
                    </div>
                    
                    <!-- æé†’æ’ç¨‹ç‹€æ…‹ -->
                    <div id="reminderScheduleStatus" style="display: none; margin-top: 15px; padding: 15px; border-radius: 10px; background: #e8f5e9;">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span style="font-size: 1.5em;">âœ…</span>
                            <div>
                                <div style="font-weight: 600; color: #2e7d32;">æé†’æ’ç¨‹å·²å•Ÿç”¨</div>
                                <div id="reminderScheduleInfo" style="font-size: 0.9em; color: #558b2f; margin-top: 3px;"></div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- æé†’èªªæ˜ -->
                    <div style="margin-top: 15px; padding: 12px 15px; background: #fff3e0; border-radius: 10px; border-left: 4px solid #ff9800;">
                        <div style="display: flex; align-items: flex-start; gap: 10px;">
                            <span style="font-size: 1.2em;">ğŸ’¡</span>
                            <div style="font-size: 0.9em; color: #e65100; line-height: 1.6;">
                                <strong>é‹ä½œæ–¹å¼ï¼š</strong><br>
                                â€¢ åŒ¯å…¥ç ”ç¿’æ™‚ï¼Œç³»çµ±æœƒè‡ªå‹•å»ºç«‹æé†’æ’ç¨‹<br>
                                â€¢ GAS å¾Œç«¯æ¯ 15 åˆ†é˜æª¢æŸ¥ä¸€æ¬¡<br>
                                â€¢ åˆ°é”æé†’æ™‚é–“æ™‚è‡ªå‹•ç™¼é€ LINE é€šçŸ¥<br>
                                â€¢ éœ€è¦éƒ¨ç½²æ–°ç‰ˆ GASï¼ˆå«æ’ç¨‹åŠŸèƒ½ï¼‰
                            </div>
                        </div>
                    </div>
                    
                    <!-- ç®¡ç†æ’ç¨‹æŒ‰éˆ• -->
                    <div style="display: flex; gap: 10px; margin-top: 15px;">
                        <button class="btn-secondary" onclick="viewScheduledReminders()" style="flex: 1;">
                            ğŸ“‹ æŸ¥çœ‹æ’ç¨‹
                        </button>
                        <button class="btn-secondary" onclick="clearAllReminders()" style="flex: 1; background: #ffebee; color: #c62828; border-color: #ef9a9a;">
                            ğŸ—‘ï¸ æ¸…é™¤å…¨éƒ¨
                        </button>
                    </div>
                </div>

                <!-- LINE é€šçŸ¥ç‹€æ…‹ -->
                <div id="lineNotifyStatus" style="margin-top: 15px; display: none;"></div>
            </div>

            <!-- è¼¸å…¥æ–¹å¼é¸æ“‡ -->
            <div class="section">
                <div class="section-title">ğŸ“ è¼¸å…¥ç ”ç¿’æ™‚ç¨‹è¡¨</div>
                <div class="tabs">
                    <button class="tab active" onclick="switchTab('text')">ğŸ“„ æ–‡å­—è¼¸å…¥</button>
                    <button class="tab" onclick="switchTab('file')">ğŸ“ æª”æ¡ˆä¸Šå‚³</button>
                    <button class="tab" onclick="switchTab('image')">ğŸ–¼ï¸ åœ–ç‰‡ä¸Šå‚³</button>
                </div>

                <!-- æ–‡å­—è¼¸å…¥ -->
                <div class="tab-content active" id="text-content">
                    <div class="input-group">
                        <label for="scheduleText">è«‹è²¼ä¸Šç ”ç¿’æ™‚ç¨‹è¡¨å…§å®¹</label>
                        <div class="format-hint">
                            ğŸ’¡ <strong>æ”¯æ´æ ¼å¼ï¼š</strong>å¯ç›´æ¥è²¼ä¸Šæ–‡å­—ã€è¤‡è£½è‡ª Google Calendarã€æˆ–ä»»ä½•åŒ…å«æ™‚é–“è³‡è¨Šçš„æ–‡æœ¬<br>
                            ğŸ‡¹ğŸ‡¼ <strong>æ”¯æ´æ°‘åœ‹å¹´ï¼š</strong>è‡ªå‹•å°‡ 114å¹´ è½‰æ›ç‚º 2025å¹´ï¼ˆæ°‘åœ‹å¹´+1911=è¥¿å…ƒå¹´ï¼‰
                        </div>
                        <textarea id="scheduleText" placeholder="ç¯„ä¾‹ 1ï¼ˆå®Œæ•´æ ¼å¼ï¼‰ï¼š
2024å¹´11æœˆ21æ—¥ 19:00-20:30
äº®äº®-Google Antigravity IDE æ•´åˆé–‹ç™¼å·¥å…·+ Sora2+AI Agentå¯¦å¢ƒè§£è¬
åœ°é»ï¼šGoogle Meet (https://meet.google.com/wua-jbxm-km)
è¬›å¸«ï¼šäº®äº®è€å¸«
å‚™è¨»ï¼š#Google Antigravity #Sora2 #AI Agent

ç¯„ä¾‹ 2ï¼ˆæ°‘åœ‹å¹´æ ¼å¼ï¼‰ï¼š
114å¹´12æœˆ5æ—¥ 14:00-16:00 Python ç¨‹å¼è¨­è¨ˆå…¥é–€
åœ°é»ï¼šé›»è…¦æ•™å®¤ A
è¬›å¸«ï¼šç‹è€å¸«

ç¯„ä¾‹ 3ï¼ˆç›¸å°æ—¥æœŸï¼‰ï¼š
æ˜å¤© 09:00-12:00 AI æ•™å­¸æ‡‰ç”¨ç ”ç¿’
é€±äº” 13:30-15:30 æ•¸ä½æ•™å­¸å·¥ä½œåŠ"></textarea>
                    </div>
                </div>

                <!-- æª”æ¡ˆä¸Šå‚³ -->
                <div class="tab-content" id="file-content">
                    <div class="input-group">
                        <label>ğŸ“ æª”æ¡ˆä¸Šå‚³æ”¯æ´æ ¼å¼ <span id="fileCountBadge" class="file-count-badge" style="display: none;">å·²ç´¯åŠ  0 å€‹æª”æ¡ˆ</span></label>
                        <div class="format-hint">
                            ğŸ’¡ <strong>æ”¯æ´æ ¼å¼ï¼š</strong>Excel (.xls, .xlsx)ã€æ–‡å­—æª” (.txt)ã€CSV (.csv)ã€PDF (.pdf)<br>
                            <strong>ç´¯åŠ æ¨¡å¼ï¼š</strong>å¯å¤šæ¬¡ä¸Šå‚³æª”æ¡ˆï¼Œå…§å®¹æœƒè‡ªå‹•ç´¯åŠ åˆä½µ
                        </div>
                    </div>
                    <div class="file-upload" onclick="document.getElementById('fileUpload').click()">
                        <input type="file" id="fileUpload" accept=".xls,.xlsx,.txt,.csv,.pdf" onchange="handleFileUpload(event)">
                        <div class="file-upload-icon">ğŸ“</div>
                        <div class="file-upload-text">é»æ“Šä¸Šå‚³ç ”ç¿’æ™‚ç¨‹è¡¨æª”æ¡ˆ</div>
                        <div class="file-upload-hint">æ”¯æ´ Excelã€TXTã€CSVã€PDF æ ¼å¼ï¼ˆå»ºè­° 5MB ä»¥å…§ï¼‰<br>æ”¯æ´å¤šæ¬¡ä¸Šå‚³ç´¯åŠ </div>
                    </div>
                    <div id="fileInfo" style="margin-top: 15px; display: none;">
                        <div style="background: #e8f5e9; padding: 15px; border-radius: 10px; border-left: 4px solid #4caf50;">
                            <div style="font-weight: 600; color: #2e7d32; margin-bottom: 5px;">âœ… æª”æ¡ˆå·²è¼‰å…¥</div>
                            <div id="fileName" style="color: #666; font-size: 0.9em;"></div>
                            <div id="fileSize" style="color: #999; font-size: 0.85em; margin-top: 3px;"></div>
                        </div>
                    </div>
                </div>

                <!-- åœ–ç‰‡ä¸Šå‚³ -->
                <div class="tab-content" id="image-content">
                    <div class="input-group">
                        <label>ğŸ“¸ OCR è¾¨è­˜æœ€ä½³å¯¦è¸ <span id="imageCountBadge" class="file-count-badge" style="display: none;">å·²ç´¯åŠ  0 å¼µåœ–ç‰‡</span></label>
                        <div class="ocr-tips">
                            <strong>ç‚ºç²å¾—æœ€ä½³è¾¨è­˜æ•ˆæœï¼Œè«‹ç¢ºä¿ï¼š</strong>
                            <div class="ocr-tips-item">âœ“ åœ–ç‰‡æ¸…æ™°ï¼Œå…‰ç·šå……è¶³ï¼Œé¿å…æ¨¡ç³Š</div>
                            <div class="ocr-tips-item">âœ“ æ–‡å­—æ°´å¹³æ“ºæ”¾ï¼Œé¿å…å‚¾æ–œæˆ–æ—‹è½‰</div>
                            <div class="ocr-tips-item">âœ“ å°ç„¦æº–ç¢ºï¼Œæ‰€æœ‰æ–‡å­—æ¸…æ¥šå¯è®€</div>
                            <div class="ocr-tips-item">âœ“ æ”¯æ´ Google Calendar æˆªåœ–ã€æµ·å ±ã€æ–‡ä»¶ç­‰å¤šç¨®æ ¼å¼</div>
                            <div class="ocr-tips-item">âœ“ <strong>ç´¯åŠ æ¨¡å¼ï¼š</strong>å¯å¤šæ¬¡ä¸Šå‚³åœ–ç‰‡ï¼Œå…§å®¹æœƒè‡ªå‹•ç´¯åŠ åˆä½µ</div>
                        </div>
                    </div>
                    <div class="file-upload" onclick="document.getElementById('imageUpload').click()">
                        <input type="file" id="imageUpload" accept="image/*" onchange="handleImageUpload(event)">
                        <div class="file-upload-icon">ğŸ“¸</div>
                        <div class="file-upload-text">é»æ“Šä¸Šå‚³ç ”ç¿’æ™‚ç¨‹è¡¨åœ–ç‰‡</div>
                        <div class="file-upload-hint">æ”¯æ´ JPGã€PNGã€WEBP æ ¼å¼ï¼ˆå»ºè­° 2MB ä»¥å…§ï¼‰<br>æ”¯æ´å¤šæ¬¡ä¸Šå‚³ç´¯åŠ </div>
                    </div>
                    <img id="imagePreview" class="preview-image" style="display: none;">
                </div>
            </div>

            <!-- æé†’è¨­å®š -->
            <div class="section">
                <div class="section-title">â° æé†’è¨­å®š</div>
                <div class="reminder-options">
                    <div class="checkbox-option">
                        <input type="checkbox" id="remind30" value="30" onchange="updateCheckboxStyle(this)">
                        <label for="remind30">æå‰ 30 åˆ†é˜</label>
                    </div>
                    <div class="checkbox-option checked">
                        <input type="checkbox" id="remind60" value="60" checked onchange="updateCheckboxStyle(this)">
                        <label for="remind60">æå‰ 1 å°æ™‚</label>
                    </div>
                    <div class="checkbox-option">
                        <input type="checkbox" id="remind90" value="90" onchange="updateCheckboxStyle(this)">
                        <label for="remind90">æå‰ 1.5 å°æ™‚</label>
                    </div>
                    <div class="checkbox-option">
                        <input type="checkbox" id="remind120" value="120" onchange="updateCheckboxStyle(this)">
                        <label for="remind120">æå‰ 2 å°æ™‚</label>
                    </div>
                    <div class="checkbox-option">
                        <input type="checkbox" id="remind1440" value="1440" onchange="updateCheckboxStyle(this)">
                        <label for="remind1440">æå‰ 1 å¤©</label>
                    </div>
                </div>
            </div>

            <!-- åŸ·è¡ŒæŒ‰éˆ• -->
            <button class="btn btn-primary" onclick="parseSchedule()">
                <span id="btnText">ğŸš€ <span id="btnAction">AI æ™ºèƒ½è§£æ</span></span>
                <span id="btnLoading" style="display: none;"><div class="loading"></div> <span id="loadingText">è™•ç†ä¸­...</span></span>
            </button>

            <!-- ç‹€æ…‹è¨Šæ¯ -->
            <div id="statusMessage" class="status-message"></div>

            <!-- äº‹ä»¶é è¦½ -->
            <div id="eventsPreview" class="events-preview"></div>

            <!-- åŒ¯å…¥é¸é …æŒ‰éˆ• -->
            <div style="display: flex; gap: 15px; flex-wrap: wrap; margin-top: 20px;" id="importButtonsContainer" style="display: none;">
                <button class="btn btn-secondary" id="addToCalendarBtn" onclick="addToGoogleCalendar()" style="flex: 1; min-width: 200px; position: relative;">
                    ğŸ”— Google OAuth åŒ¯å…¥
                    <div style="font-size: 0.85em; opacity: 0.9; margin-top: 5px;">
                        <span id="serverStatusText">æ™ºèƒ½æª¢æ¸¬ç’°å¢ƒä¸­...</span>
                    </div>
                </button>
                <button class="btn btn-primary" id="downloadIcsBtn" onclick="downloadICS()" style="flex: 1; min-width: 200px;">
                    ğŸ“¥ ä¸‹è¼‰ ICS æª”æ¡ˆ
                    <div style="font-size: 0.85em; opacity: 0.9; margin-top: 5px;">æœ¬æ©Ÿç«¯å¯ç”¨</div>
                </button>
            </div>
        </div>

        <!-- åŒ¯å…¥çµæœå½ˆå‡ºè¦–çª— -->
        <div id="resultModal" class="modal-overlay">
            <div class="modal-content">
                <div id="resultIcon" class="modal-icon">âœ…</div>
                <div id="resultTitle" class="modal-title">åŒ¯å…¥æˆåŠŸï¼</div>
                <div id="resultMessage" class="modal-message">
                    å·²æˆåŠŸå°‡ <strong id="successCountDisplay">0</strong> å€‹äº‹ä»¶è‡ªå‹•åŒ¯å…¥ Google æ—¥æ›†
                </div>
                <div id="resultDetails" class="result-details"></div>
                <div style="display: flex; gap: 15px; justify-content: center; margin-top: 25px; flex-wrap: wrap;">
                    <button class="modal-btn modal-btn-primary" onclick="openGoogleCalendar()">
                        ğŸ“… é¡¯ç¤ºæ—¥æ›†
                    </button>
                    <button class="modal-btn modal-btn-success" onclick="downloadICSFromModal()" style="background: linear-gradient(135deg, #43a047 0%, #2e7d32 100%);">
                        ğŸ“¥ ä¸‹è¼‰ ICS æª”æ¡ˆ
                    </button>
                    <button class="modal-btn modal-btn-secondary" onclick="closeResultModal()">
                        âœ–ï¸ é—œé–‰è¦–çª—
                    </button>
                </div>
            </div>
        </div>

        <!-- ğŸš€ æ™ºèƒ½å¼•å°å½ˆçª— -->
        <div id="serverGuideModal" class="modal-overlay" style="display: none;">
            <div class="modal-content" style="max-width: 700px;">
                <div class="modal-icon" style="background: linear-gradient(135deg, #f59e0b 0%, #f97316 100%); font-size: 3em;">
                    âš ï¸
                </div>
                <div class="modal-title" style="color: #f97316;">éœ€è¦å•Ÿå‹•æœ¬åœ°ä¼ºæœå™¨</div>
                <div class="modal-message" style="text-align: left; line-height: 1.8;">
                    <p style="margin: 0 0 15px 0; color: #555; font-size: 1.05em;">
                        Google OAuth åŠŸèƒ½éœ€è¦åœ¨æœ¬åœ°ä¼ºæœå™¨ç’°å¢ƒä¸‹é‹è¡Œã€‚æª¢æ¸¬åˆ°æ‚¨ç›®å‰æ˜¯å¾æª”æ¡ˆç³»çµ±ç›´æ¥é–‹å•Ÿæ­¤é é¢ã€‚
                    </p>
                </div>
                
                <div style="display: flex; gap: 15px; justify-content: center; margin-top: 25px; flex-wrap: wrap;">
                    <button class="modal-btn modal-btn-secondary" onclick="closeServerGuideModal()">
                        çŸ¥é“äº†
                    </button>
                </div>
            </div>
        </div>

        <div class="footer">
            <p>Created with â¤ï¸ for æ•™è‚²å·¥ä½œè€… | Powered by Gemini 2.0 Flash</p>
            <p style="font-size: 0.95em; color: #667eea; margin-top: 8px; font-weight: 600;">
                Made by Sone Wang 2025 1122 | æ”¯æ´æ°‘åœ‹å¹´è½‰æ›
            </p>
        </div>
    </div>

    <!-- ğŸ“š å¹«åŠ©ä¸­å¿ƒæ¨¡æ…‹è¦–çª— (ç°¡åŒ–ç‰ˆ) -->
    <div class="help-modal" id="helpModal">
        <div class="help-modal-content">
            <div class="help-modal-header">
                <h2>ğŸ“š å¹«åŠ©ä¸­å¿ƒ</h2>
                <button class="close-button" onclick="closeHelp()">âœ–</button>
            </div>
            
            <div class="help-content">
                <h3>ğŸ‡¹ğŸ‡¼ æ°‘åœ‹å¹´è½‰æ›åŠŸèƒ½</h3>
                <p>æœ¬å·¥å…·å·²æ”¯æ´è‡ªå‹•è­˜åˆ¥ä¸¦è½‰æ›æ°‘åœ‹å¹´æ ¼å¼ï¼š</p>
                <ul>
                    <li><strong>å…¬å¼ï¼š</strong>æ°‘åœ‹å¹´ + 1911 = è¥¿å…ƒå¹´</li>
                    <li><strong>ç¯„ä¾‹ï¼š</strong>114å¹´12æœˆ5æ—¥ â†’ 2025-12-05</li>
                    <li><strong>ç¯„ä¾‹ï¼š</strong>115å¹´9æœˆ22æ—¥ â†’ 2026-09-22</li>
                    <li><strong>ç¯„ä¾‹ï¼š</strong>æ°‘åœ‹113å¹´11æœˆ21æ—¥ â†’ 2024-11-21</li>
                </ul>
                
                <div class="info-box">
                    <strong>ğŸ’¡ æ”¯æ´çš„æ°‘åœ‹å¹´æ ¼å¼</strong><br>
                    â€¢ 114å¹´ã€æ°‘åœ‹114å¹´ã€ä¸­è¯æ°‘åœ‹114å¹´<br>
                    â€¢ 114/12/05ã€114.12.05<br>
                    â€¢ ç ”ç¿’ç·¨è™Ÿä¸­çš„æ—¥æœŸï¼ˆå¦‚ 1140919 â†’ 2025-09-19ï¼‰
                </div>
                
                <h3>ğŸš€ å¿«é€Ÿé–‹å§‹</h3>
                <ol>
                    <li>è¼¸å…¥æˆ–è²¼ä¸Šç ”ç¿’æ™‚ç¨‹è¡¨ï¼ˆæ”¯æ´æ°‘åœ‹å¹´æ ¼å¼ï¼‰</li>
                    <li>é»æ“Šã€ŒAI æ™ºèƒ½è§£æã€</li>
                    <li>ç¢ºèªè§£æçµæœå¾Œï¼Œé¸æ“‡åŒ¯å…¥æ–¹å¼</li>
                </ol>
            </div>
        </div>
    </div>

    <script>
        console.log('=== ç ”ç¿’å·¥å…·åˆå§‹åŒ–é–‹å§‹ ===');
        console.log('æ™‚é–“:', new Date().toLocaleString('zh-TW'));

        // ========================================
        // å…¨åŸŸè®Šæ•¸
        // ========================================
        var parsedEvents = [];
        var accessToken = null;
        var tokenClient = null;
        var gapiInited = false;
        var gisInited = false;
        var uploadedImagesArray = [];
        var uploadedFilesContentArray = [];
        var fileUploadCount = 0;
        var imageUploadCount = 0;
        const DISCOVERY_DOC = 'https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest';
        const SCOPES = 'https://www.googleapis.com/auth/calendar.events';

        // ========================================
        // æ°‘åœ‹å¹´è½‰æ›è¼”åŠ©å‡½æ•¸
        // ========================================
        function convertMinguoToWestern(text) {
            if (!text) return text;
            
            // è½‰æ›ã€Œæ°‘åœ‹XXXå¹´ã€æˆ–ã€Œä¸­è¯æ°‘åœ‹XXXå¹´ã€æ ¼å¼
            text = text.replace(/(?:æ°‘åœ‹|ä¸­è¯æ°‘åœ‹)?(\d{2,3})å¹´(\d{1,2})æœˆ(\d{1,2})æ—¥?/g, function(match, year, month, day) {
                var yearNum = parseInt(year);
                if (yearNum <= 200) {
                    yearNum += 1911;
                }
                return yearNum + 'å¹´' + month + 'æœˆ' + day + 'æ—¥';
            });
            
            // è½‰æ›ã€ŒXXX/MM/DDã€æ ¼å¼ï¼ˆæ°‘åœ‹å¹´ï¼‰
            text = text.replace(/(\d{2,3})\/(\d{1,2})\/(\d{1,2})/g, function(match, year, month, day) {
                var yearNum = parseInt(year);
                if (yearNum <= 200) {
                    yearNum += 1911;
                }
                return yearNum + '/' + month + '/' + day;
            });
            
            return text;
        }

        // ========================================
        // æœ¬æ©Ÿå„²å­˜åŠŸèƒ½
        // ========================================
        var localStorageEnabled = false;
        var STORAGE_PREFIX = 'workshop_tool_';

        window.addEventListener('load', function() {
            try {
                var savedEnabled = localStorage.getItem(STORAGE_PREFIX + 'enabled');
                if (savedEnabled === 'true') {
                    localStorageEnabled = true;
                    document.getElementById('enableLocalStorage').checked = true;
                    loadFromLocalStorage();
                }
            } catch (e) {
                console.log('ç„¡æ³•è®€å–æœ¬æ©Ÿå„²å­˜');
            }
        });

        function toggleLocalStorage(checkbox) {
            if (checkbox.checked) {
                if (confirm('âš ï¸ è­¦å‘Šï¼šå•Ÿç”¨æœ¬æ©Ÿå„²å­˜æœƒåœ¨æ‚¨çš„é›»è…¦ä¸­å„²å­˜ API é‡‘é‘°ç­‰æ•æ„Ÿè³‡è¨Šã€‚\n\nè«‹ç¢ºèªï¼š\n1. é€™æ˜¯æ‚¨çš„å€‹äººç§æœ‰é›»è…¦\n2. æ‚¨ä¸æœƒå°‡æ­¤å·¥å…·åˆ†äº«çµ¦ä»–äºº\n3. æ‚¨äº†è§£ä¸¦æ¥å—å®‰å…¨é¢¨éšª\n\nç¢ºå®šè¦å•Ÿç”¨å—ï¼Ÿ')) {
                    localStorageEnabled = true;
                    try {
                        localStorage.setItem(STORAGE_PREFIX + 'enabled', 'true');
                        saveToLocalStorage();
                        showStatus('âœ… å·²å•Ÿç”¨æœ¬æ©Ÿè‡ªå‹•å„²å­˜', 'success');
                    } catch (e) {
                        showStatus('âŒ ç„¡æ³•å•Ÿç”¨æœ¬æ©Ÿå„²å­˜ï¼š' + e.message, 'error');
                        checkbox.checked = false;
                        localStorageEnabled = false;
                    }
                } else {
                    checkbox.checked = false;
                }
            } else {
                if (confirm('ç¢ºå®šè¦åœç”¨æœ¬æ©Ÿå„²å­˜ä¸¦æ¸…é™¤æ‰€æœ‰å·²å„²å­˜çš„è³‡æ–™å—ï¼Ÿ')) {
                    localStorageEnabled = false;
                    clearLocalStorage();
                    showStatus('âœ… å·²åœç”¨æœ¬æ©Ÿå„²å­˜ä¸¦æ¸…é™¤è³‡æ–™', 'success');
                } else {
                    checkbox.checked = true;
                }
            }
            setTimeout(hideStatus, 3000);
        }

        function saveToLocalStorage() {
            if (!localStorageEnabled) return;
            try {
                localStorage.setItem(STORAGE_PREFIX + 'googleClientId', document.getElementById('googleClientId').value);
                localStorage.setItem(STORAGE_PREFIX + 'geminiApiKey', document.getElementById('geminiApiKey').value);
                localStorage.setItem(STORAGE_PREFIX + 'lineToken', document.getElementById('lineChannelAccessToken').value);
                localStorage.setItem(STORAGE_PREFIX + 'lineUserId', document.getElementById('lineUserId').value);
                localStorage.setItem(STORAGE_PREFIX + 'gasUrl', document.getElementById('gasWebAppUrl').value);
                localStorage.setItem(STORAGE_PREFIX + 'gasSecret', document.getElementById('gasSecretKey').value);
            } catch (e) {
                console.error('å„²å­˜å¤±æ•—:', e);
            }
        }

        function loadFromLocalStorage() {
            try {
                var googleClientId = localStorage.getItem(STORAGE_PREFIX + 'googleClientId');
                var geminiApiKey = localStorage.getItem(STORAGE_PREFIX + 'geminiApiKey');
                var lineToken = localStorage.getItem(STORAGE_PREFIX + 'lineToken');
                var lineUserId = localStorage.getItem(STORAGE_PREFIX + 'lineUserId');
                var gasUrl = localStorage.getItem(STORAGE_PREFIX + 'gasUrl');
                var gasSecret = localStorage.getItem(STORAGE_PREFIX + 'gasSecret');
                
                if (googleClientId) document.getElementById('googleClientId').value = googleClientId;
                if (geminiApiKey) document.getElementById('geminiApiKey').value = geminiApiKey;
                if (lineToken) document.getElementById('lineChannelAccessToken').value = lineToken;
                if (lineUserId) document.getElementById('lineUserId').value = lineUserId;
                if (gasUrl) document.getElementById('gasWebAppUrl').value = gasUrl;
                if (gasSecret) document.getElementById('gasSecretKey').value = gasSecret;
                
                console.log('âœ… å·²å¾æœ¬æ©Ÿå„²å­˜è¼‰å…¥è¨­å®š');
            } catch (e) {
                console.error('è¼‰å…¥å¤±æ•—:', e);
            }
        }

        function clearLocalStorage() {
            try {
                localStorage.removeItem(STORAGE_PREFIX + 'enabled');
                localStorage.removeItem(STORAGE_PREFIX + 'googleClientId');
                localStorage.removeItem(STORAGE_PREFIX + 'geminiApiKey');
                localStorage.removeItem(STORAGE_PREFIX + 'lineToken');
                localStorage.removeItem(STORAGE_PREFIX + 'lineUserId');
                localStorage.removeItem(STORAGE_PREFIX + 'gasUrl');
                localStorage.removeItem(STORAGE_PREFIX + 'gasSecret');
            } catch (e) {
                console.error('æ¸…é™¤å¤±æ•—:', e);
            }
        }

        // ========================================
        // å¹«åŠ©ä¸­å¿ƒåŠŸèƒ½
        // ========================================
        function openHelp() {
            var modal = document.getElementById('helpModal');
            if (modal) {
                modal.classList.add('show');
                modal.style.display = 'flex';
            }
        }
        
        function closeHelp() {
            var modal = document.getElementById('helpModal');
            if (modal) {
                modal.classList.remove('show');
                modal.style.display = 'none';
            }
        }

        // ========================================
        // Tab åˆ‡æ›åŠŸèƒ½
        // ========================================
        function switchTab(tabName) {
            var tabs = document.querySelectorAll('.tab');
            var tabContents = document.querySelectorAll('.tab-content');
            
            tabs.forEach(function(tab) { tab.classList.remove('active'); });
            tabContents.forEach(function(content) { content.classList.remove('active'); });
            
            event.target.classList.add('active');
            document.getElementById(tabName + '-content').classList.add('active');
        }

        // ========================================
        // é¡¯ç¤º/éš±è—å¯†ç¢¼åŠŸèƒ½
        // ========================================
        function toggleClientIdVisibility() {
            var input = document.getElementById('googleClientId');
            var icon = document.getElementById('clientIdEyeIcon');
            if (input.type === 'password') { input.type = 'text'; icon.textContent = 'ğŸ™ˆ'; }
            else { input.type = 'password'; icon.textContent = 'ğŸ‘ï¸'; }
        }

        function toggleApiKeyVisibility() {
            var input = document.getElementById('geminiApiKey');
            var icon = document.getElementById('eyeIcon');
            if (input.type === 'password') { input.type = 'text'; icon.textContent = 'ğŸ™ˆ'; }
            else { input.type = 'password'; icon.textContent = 'ğŸ‘ï¸'; }
        }

        function toggleLineTokenVisibility() {
            var input = document.getElementById('lineChannelAccessToken');
            var icon = document.getElementById('lineTokenEyeIcon');
            if (input.type === 'password') { input.type = 'text'; icon.textContent = 'ğŸ™ˆ'; }
            else { input.type = 'password'; icon.textContent = 'ğŸ‘ï¸'; }
        }

        function toggleLineUserIdVisibility() {
            var input = document.getElementById('lineUserId');
            var icon = document.getElementById('lineUserIdEyeIcon');
            if (input.type === 'password') { input.type = 'text'; icon.textContent = 'ğŸ™ˆ'; }
            else { input.type = 'password'; icon.textContent = 'ğŸ‘ï¸'; }
        }

        function toggleGasUrlVisibility() {
            var input = document.getElementById('gasWebAppUrl');
            var icon = document.getElementById('gasUrlEyeIcon');
            if (input.type === 'password') { input.type = 'text'; icon.textContent = 'ğŸ™ˆ'; }
            else { input.type = 'password'; icon.textContent = 'ğŸ‘ï¸'; }
        }

        function toggleSecretKeyVisibility() {
            var input = document.getElementById('gasSecretKey');
            var icon = document.getElementById('secretKeyEyeIcon');
            if (input.type === 'password') { input.type = 'text'; icon.textContent = 'ğŸ™ˆ'; }
            else { input.type = 'password'; icon.textContent = 'ğŸ‘ï¸'; }
        }

        // ========================================
        // æ¸…é™¤é‡‘é‘°åŠŸèƒ½
        // ========================================
        function clearGoogleClientId() {
            if (confirm('ç¢ºå®šè¦æ¸…é™¤ Google OAuth Client ID å—ï¼Ÿ')) {
                document.getElementById('googleClientId').value = '';
                saveToLocalStorage();
                showStatus('âœ… å·²æ¸…é™¤ Google OAuth Client ID', 'success');
                setTimeout(hideStatus, 2000);
            }
        }

        function clearApiKey() {
            if (confirm('ç¢ºå®šè¦æ¸…é™¤ Gemini API Key å—ï¼Ÿ')) {
                document.getElementById('geminiApiKey').value = '';
                saveToLocalStorage();
                showStatus('âœ… å·²æ¸…é™¤ Gemini API Key', 'success');
                setTimeout(hideStatus, 2000);
            }
        }

        function clearLineToken() {
            if (confirm('ç¢ºå®šè¦æ¸…é™¤ LINE Channel Access Token å—ï¼Ÿ')) {
                document.getElementById('lineChannelAccessToken').value = '';
                saveToLocalStorage();
                showStatus('âœ… å·²æ¸…é™¤ LINE Token', 'success');
                setTimeout(hideStatus, 2000);
            }
        }

        function clearLineUserId() {
            if (confirm('ç¢ºå®šè¦æ¸…é™¤ LINE User ID å—ï¼Ÿ')) {
                document.getElementById('lineUserId').value = '';
                saveToLocalStorage();
                showStatus('âœ… å·²æ¸…é™¤ LINE User ID', 'success');
                setTimeout(hideStatus, 2000);
            }
        }

        function clearGasUrl() {
            if (confirm('ç¢ºå®šè¦æ¸…é™¤ Google Apps Script URL å—ï¼Ÿ')) {
                document.getElementById('gasWebAppUrl').value = '';
                saveToLocalStorage();
                showStatus('âœ… å·²æ¸…é™¤ GAS URL', 'success');
                setTimeout(hideStatus, 2000);
            }
        }

        function clearSecretKey() {
            if (confirm('ç¢ºå®šè¦æ¸…é™¤å®‰å…¨é‡‘é‘°å—ï¼Ÿ')) {
                document.getElementById('gasSecretKey').value = '';
                saveToLocalStorage();
                showStatus('âœ… å·²æ¸…é™¤å®‰å…¨é‡‘é‘°', 'success');
                setTimeout(hideStatus, 2000);
            }
        }

        // ========================================
        // Checkbox æ¨£å¼æ›´æ–°
        // ========================================
        function updateCheckboxStyle(checkbox) {
            var parent = checkbox.parentElement;
            if (checkbox.checked) { parent.classList.add('checked'); }
            else { parent.classList.remove('checked'); }
        }

        // ========================================
        // ç‹€æ…‹è¨Šæ¯é¡¯ç¤º
        // ========================================
        function showStatus(message, type) {
            var statusDiv = document.getElementById('statusMessage');
            statusDiv.textContent = message;
            statusDiv.className = 'status-message ' + type;
            statusDiv.style.display = 'block';
        }

        function hideStatus() {
            var statusDiv = document.getElementById('statusMessage');
            statusDiv.style.display = 'none';
        }

        // ========================================
        // æª”æ¡ˆä¸Šå‚³è™•ç†
        // ========================================
        function handleFileUpload(event) {
            var file = event.target.files[0];
            if (!file) return;
            
            document.getElementById('fileName').textContent = 'ğŸ“„ ' + file.name;
            document.getElementById('fileSize').textContent = 'å¤§å°ï¼š' + (file.size / 1024).toFixed(2) + ' KB';
            document.getElementById('fileInfo').style.display = 'block';
            
            showStatus('ğŸ“¤ æ­£åœ¨è®€å–æª”æ¡ˆ...', 'info');

            var reader = new FileReader();
            var fileName = file.name.toLowerCase();
            var fileExt = fileName.substring(fileName.lastIndexOf('.'));
            
            reader.onload = function(e) {
                var content = '';
                
                try {
                    if (fileExt === '.txt' || fileExt === '.csv') {
                        content = e.target.result;
                    } else if (fileExt === '.xls' || fileExt === '.xlsx') {
                        var data = new Uint8Array(e.target.result);
                        var workbook = XLSX.read(data, {type: 'array'});
                        var firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                        content = XLSX.utils.sheet_to_csv(firstSheet);
                    }
                    
                    uploadedFilesContentArray.push({ content: content, type: fileExt, name: file.name });
                    fileUploadCount++;
                    updateFileCountBadge();
                    
                    var existingText = document.getElementById('scheduleText').value.trim();
                    if (existingText) {
                        document.getElementById('scheduleText').value = existingText + '\n\n' + content;
                    } else {
                        document.getElementById('scheduleText').value = content;
                    }
                    
                    showStatus('âœ… æª”æ¡ˆå·²è¼‰å…¥ï¼ˆå…± ' + fileUploadCount + ' å€‹ï¼‰', 'success');
                    setTimeout(hideStatus, 2000);
                    
                } catch (error) {
                    showStatus('âŒ æª”æ¡ˆè™•ç†å¤±æ•—: ' + error.message, 'error');
                }
            };
            
            if (fileExt === '.txt' || fileExt === '.csv') {
                reader.readAsText(file);
            } else {
                reader.readAsArrayBuffer(file);
            }
        }

        function handleImageUpload(event) {
            var file = event.target.files[0];
            if (!file) return;
            
            var reader = new FileReader();
            reader.onload = function(e) {
                var img = new Image();
                img.onload = function() {
                    var canvas = document.createElement('canvas');
                    var ctx = canvas.getContext('2d');
                    var MAX_WIDTH = 2048;
                    var MAX_HEIGHT = 2048;
                    var width = img.width;
                    var height = img.height;

                    if (width > MAX_WIDTH || height > MAX_HEIGHT) {
                        if (width > height) {
                            if (width > MAX_WIDTH) { height *= MAX_WIDTH / width; width = MAX_WIDTH; }
                        } else {
                            if (height > MAX_HEIGHT) { width *= MAX_HEIGHT / height; height = MAX_HEIGHT; }
                        }
                    }

                    canvas.width = width;
                    canvas.height = height;
                    ctx.drawImage(img, 0, 0, width, height);
                    var compressedDataUrl = canvas.toDataURL('image/jpeg', 0.92);
                    var base64Data = compressedDataUrl.split(',')[1];
                    
                    uploadedImagesArray.push(base64Data);
                    imageUploadCount++;
                    updateImageCountBadge();
                    
                    document.getElementById('imagePreview').src = compressedDataUrl;
                    document.getElementById('imagePreview').style.display = 'block';
                    
                    showStatus('âœ… åœ–ç‰‡å·²è¼‰å…¥ï¼ˆå…± ' + imageUploadCount + ' å¼µï¼‰', 'success');
                    setTimeout(hideStatus, 2000);
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        function updateFileCountBadge() {
            var badge = document.getElementById('fileCountBadge');
            if (fileUploadCount > 0) {
                badge.textContent = 'å·²ç´¯åŠ  ' + fileUploadCount + ' å€‹æª”æ¡ˆ';
                badge.style.display = 'inline-block';
            }
        }

        function updateImageCountBadge() {
            var badge = document.getElementById('imageCountBadge');
            if (imageUploadCount > 0) {
                badge.textContent = 'å·²ç´¯åŠ  ' + imageUploadCount + ' å¼µåœ–ç‰‡';
                badge.style.display = 'inline-block';
            }
        }

        // ========================================
        // LINE é€šçŸ¥åŠŸèƒ½ï¼ˆç°¡åŒ–ç‰ˆï¼‰
        // ========================================
        async function testLineNotification() {
            showStatus('ğŸ“¨ æ¸¬è©¦åŠŸèƒ½ï¼ˆè«‹åƒè€ƒå®Œæ•´ç‰ˆæœ¬ï¼‰', 'info');
            setTimeout(hideStatus, 3000);
        }

        function updateLineSendOption(checkbox) {
            showStatus(checkbox.checked ? 'âœ… å·²å•Ÿç”¨è‡ªå‹•ç™¼é€ LINE é€šçŸ¥' : 'â„¹ï¸ å·²é—œé–‰è‡ªå‹•ç™¼é€ LINE é€šçŸ¥', checkbox.checked ? 'success' : 'info');
            setTimeout(hideStatus, 2000);
        }

        function saveReminderSettings() { console.log('æé†’è¨­å®šå·²å„²å­˜'); }
        function viewScheduledReminders() { alert('è«‹æŸ¥çœ‹å®Œæ•´ç‰ˆæœ¬'); }
        function clearAllReminders() { alert('è«‹æŸ¥çœ‹å®Œæ•´ç‰ˆæœ¬'); }

        // ========================================
        // Google API åˆå§‹åŒ–
        // ========================================
        function gapiLoaded() { gapi.load('client', initializeGapiClient); }

        async function initializeGapiClient() {
            await gapi.client.init({ discoveryDocs: [DISCOVERY_DOC] });
            gapiInited = true;
            maybeEnableButtons();
        }

        function gisLoaded() {
            var clientId = document.getElementById('googleClientId');
            if (clientId && clientId.value.trim()) { initTokenClient(clientId.value.trim()); }
            if (clientId) {
                clientId.addEventListener('change', function() {
                    if (this.value.trim()) { initTokenClient(this.value.trim()); }
                });
            }
        }

        function initTokenClient(clientId) {
            tokenClient = google.accounts.oauth2.initTokenClient({
                client_id: clientId,
                scope: SCOPES,
                callback: '',
            });
            gisInited = true;
            maybeEnableButtons();
        }

        function maybeEnableButtons() {
            if (gapiInited && gisInited) {
                document.getElementById('authorizeButton').style.display = 'block';
            }
        }

        function handleAuthClick() {
            tokenClient.callback = async (resp) => {
                if (resp.error !== undefined) {
                    showAuthStatus('âŒ æˆæ¬Šå¤±æ•—: ' + resp.error, 'error');
                    throw (resp);
                }
                accessToken = gapi.client.getToken().access_token;
                showAuthStatus('âœ… å·²æˆæ¬Šå­˜å– Google æ—¥æ›†', 'success');
                document.getElementById('authorizeButton').textContent = 'âœ… å·²æˆæ¬Š';
                document.getElementById('authorizeButton').disabled = true;
            };

            if (gapi.client.getToken() === null) {
                tokenClient.requestAccessToken({prompt: 'consent'});
            } else {
                tokenClient.requestAccessToken({prompt: ''});
            }
        }

        function showAuthStatus(message, type) {
            var statusDiv = document.getElementById('authStatus');
            statusDiv.textContent = message;
            statusDiv.className = 'status-message ' + type + ' show';
            statusDiv.style.display = 'flex';
        }

        // ========================================
        // è§£æç ”ç¿’æ™‚ç¨‹è¡¨ï¼ˆåŠ å…¥æ°‘åœ‹å¹´è½‰æ›ï¼‰
        // ========================================
        async function parseSchedule() {
            var apiKey = document.getElementById('geminiApiKey').value.trim();
            
            if (!apiKey) {
                showStatus('âŒ è«‹å…ˆè¼¸å…¥ Gemini API Key', 'error');
                setTimeout(hideStatus, 3000);
                return;
            }

            var scheduleText = document.getElementById('scheduleText').value.trim();
            var activeTabText = document.querySelector('.tab.active').textContent;
            var activeTab = 'text';
            if (activeTabText.indexOf('æª”æ¡ˆ') >= 0) { activeTab = 'file'; }
            else if (activeTabText.indexOf('åœ–ç‰‡') >= 0) { activeTab = 'image'; }

            if (activeTab === 'text' && !scheduleText) {
                showStatus('âŒ è«‹è¼¸å…¥ç ”ç¿’æ™‚ç¨‹è¡¨å…§å®¹', 'error');
                setTimeout(hideStatus, 3000);
                return;
            }

            if (activeTab === 'image' && uploadedImagesArray.length === 0) {
                showStatus('âŒ è«‹ä¸Šå‚³ç ”ç¿’æ™‚ç¨‹è¡¨åœ–ç‰‡', 'error');
                setTimeout(hideStatus, 3000);
                return;
            }

            document.getElementById('btnText').style.display = 'none';
            document.getElementById('btnLoading').style.display = 'flex';
            hideStatus();

            try {
                var now = new Date();
                var currentYear = now.getFullYear();
                var currentMonth = now.getMonth() + 1;
                var currentDate = now.getDate();
                var currentDay = now.getDay();
                var dayNames = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'];
                
                var prompt = 'ä½ æ˜¯ä¸€å€‹å°ˆæ¥­çš„è¡Œäº‹æ›†åŠ©æ‰‹å’Œ OCR å°ˆå®¶ã€‚è«‹ä»”ç´°è§£æä»¥ä¸‹ç ”ç¿’æ™‚ç¨‹è¡¨ï¼Œä¸¦ä»¥ JSON æ ¼å¼å›å‚³äº‹ä»¶è³‡è¨Šã€‚\n\n';
                prompt += '**ç•¶å‰æ—¥æœŸè³‡è¨Šï¼š**\n';
                prompt += '- ä»Šå¤©æ˜¯ ' + currentYear + 'å¹´' + currentMonth + 'æœˆ' + currentDate + 'æ—¥ æ˜ŸæœŸ' + dayNames[currentDay] + '\n\n';
                prompt += '**è«‹åš´æ ¼æŒ‰ç…§ä»¥ä¸‹ JSON æ ¼å¼å›å‚³ï¼š**\n';
                prompt += '{\n  "events": [\n    {\n      "title": "æ´»å‹•åç¨±",\n      "startDateTime": "2024-01-15T09:00:00",\n      "endDateTime": "2024-01-15T12:00:00",\n      "location": "åœ°é»",\n      "description": "è¬›å¸«ã€å‚™è¨»ç­‰"\n    }\n  ]\n}\n\n';
                
                // ============== ğŸ‡¹ğŸ‡¼ æ°‘åœ‹å¹´è½‰æ›è¦å‰‡ï¼ˆæ ¸å¿ƒä¿®æ”¹ï¼‰==============
                prompt += '**æ—¥æœŸæ™‚é–“è™•ç†è¦å‰‡ï¼š**\n';
                prompt += '0. **ğŸ‡¹ğŸ‡¼ æ°‘åœ‹å¹´è½‰æ›ï¼ˆå°ç£æ ¼å¼ï¼Œæœ€é‡è¦ï¼ï¼‰**ï¼š\n';
                prompt += '   - å…¬å¼ï¼šæ°‘åœ‹å¹´ + 1911 = è¥¿å…ƒå¹´\n';
                prompt += '   - å¸¸è¦‹æ ¼å¼ï¼šã€Œ114å¹´ã€ã€Œæ°‘åœ‹114å¹´ã€ã€Œ114/12/05ã€ã€Œ114.12.05ã€ã€Œä¸­è¯æ°‘åœ‹114å¹´ã€\n';
                prompt += '   - ç¯„ä¾‹è½‰æ›ï¼š\n';
                prompt += '     â€¢ 114å¹´12æœˆ5æ—¥ â†’ 2025-12-05\n';
                prompt += '     â€¢ 115å¹´9æœˆ22æ—¥ â†’ 2026-09-22\n';
                prompt += '     â€¢ æ°‘åœ‹113å¹´11æœˆ21æ—¥ â†’ 2024-11-21\n';
                prompt += '     â€¢ 114/06/15 â†’ 2025-06-15\n';
                prompt += '     â€¢ 1140919 â†’ 2025-09-19ï¼ˆç ”ç¿’ç·¨è™Ÿä¸­çš„æ—¥æœŸï¼‰\n';
                prompt += '   - **åˆ¤æ–·æ–¹å¼**ï¼šå¦‚æœå¹´ä»½æ•¸å­— â‰¤ 200ï¼Œå°±æ˜¯æ°‘åœ‹å¹´ï¼Œéœ€è¦åŠ  1911 è½‰æ›\n';
                prompt += '   - **æ³¨æ„**ï¼šå°ç£å®˜æ–¹ç ”ç¿’å…¬å‘Šå¤§å¤šä½¿ç”¨æ°‘åœ‹å¹´æ ¼å¼ï¼Œè«‹å‹™å¿…æ­£ç¢ºè­˜åˆ¥ä¸¦è½‰æ›ï¼\n\n';
                
                var monthStr = currentMonth.toString();
                var dateStr = currentDate.toString();
                if (monthStr.length < 2) monthStr = '0' + monthStr;
                if (dateStr.length < 2) dateStr = '0' + dateStr;
                
                prompt += '1. "ä»Šå¤©"ã€"ä»Šæ—¥" â†’ ä½¿ç”¨ ' + currentYear + '-' + monthStr + '-' + dateStr + '\n';
                prompt += '2. "æ˜å¤©"ã€"æ˜æ—¥" â†’ ä½¿ç”¨ä»Šå¤©çš„æ—¥æœŸ+1å¤©\n';
                prompt += '3. "æœ¬é€±äº”"ã€"é€±äº”"ã€"æ˜ŸæœŸäº”" â†’ è¨ˆç®—æœ¬é€±æ˜ŸæœŸäº”çš„å¯¦éš›æ—¥æœŸ\n';
                prompt += '4. startDateTime å’Œ endDateTime å¿…é ˆæ˜¯å®Œæ•´çš„ ISO 8601 æ ¼å¼\n';
                prompt += '5. å¦‚æœçµæŸæ™‚é–“æ˜¯ 24:00ï¼Œè«‹æ”¹ç‚º 23:59\n';
                prompt += '6. åªæœ‰æ—¥æœŸæ²’æœ‰æ™‚é–“æ™‚ï¼Œé è¨­ç‚º 09:00-12:00\n\n';
                
                prompt += '**ğŸ¯ å°åŒ—å¸‚ç ”ç¿’æ ¼å¼ç‰¹æ®Šè™•ç†ï¼š**\n';
                prompt += '1. å¿½ç•¥ã€ŒåŒ—å¸‚ç ”ç¿’å­—ç¬¬XXXXXXXXXè™Ÿã€ç ”ç¿’ç·¨è™Ÿ\n';
                prompt += '2. å¿½ç•¥ emoji ç¬¦è™Ÿ\n';
                prompt += '3. ç¯„ä¾‹ï¼š\n';
                prompt += '   è¼¸å…¥ï¼š\n';
                prompt += '   åŒ—å¸‚ç ”ç¿’å­—ç¬¬1140919062è™Ÿ\n';
                prompt += '   è³‡å„ªè¼”å°åœ˜-ã€è—æ‰é ˜åŸŸã€‘è³‡å„ªæ•™å­¸æ‡‰ç”¨å·¥ä½œåŠ(ä¸€)\n';
                prompt += '   æ™‚é–“:114å¹´12æœˆ2æ—¥\n';
                prompt += '   åœ°é»:å¤äº­åœ‹ä¸­ä¸‰æ¨“æœƒè­°å®¤\n';
                prompt += '   è¬›å¸«:åœ‹ç«‹è‹‘è£¡é«˜ç´šä¸­å­¸é¾æ”¿å²³è€å¸«\n';
                prompt += '   \n';
                prompt += '   æ­£ç¢ºè¼¸å‡ºï¼ˆæ°‘åœ‹å¹´å·²è½‰ç‚ºè¥¿å…ƒå¹´ï¼‰ï¼š\n';
                prompt += '   {\n';
                prompt += '     "title": "è³‡å„ªè¼”å°åœ˜-ã€è—æ‰é ˜åŸŸã€‘è³‡å„ªæ•™å­¸æ‡‰ç”¨å·¥ä½œåŠ(ä¸€)",\n';
                prompt += '     "startDateTime": "2025-12-02T09:00:00",\n';
                prompt += '     "endDateTime": "2025-12-02T12:00:00",\n';
                prompt += '     "location": "å¤äº­åœ‹ä¸­ä¸‰æ¨“æœƒè­°å®¤",\n';
                prompt += '     "description": "è¬›å¸«:åœ‹ç«‹è‹‘è£¡é«˜ç´šä¸­å­¸é¾æ”¿å²³è€å¸«"\n';
                prompt += '   }\n\n';
                
                prompt += '**âš ï¸ ç‰¹åˆ¥æ³¨æ„ï¼š**\n';
                prompt += '- **æ°‘åœ‹å¹´è½‰æ›**ï¼šå°ç£å…¬æ–‡æ—¥æœŸéƒ½æ˜¯æ°‘åœ‹å¹´ï¼ˆå¦‚114å¹´ï¼‰ï¼Œå¿…é ˆ+1911è½‰æˆè¥¿å…ƒå¹´ï¼ˆ2025å¹´ï¼‰\n';
                prompt += '- åªå›å‚³ç´” JSONï¼Œä¸è¦åŒ…å«ä»»ä½• markdown æ¨™è¨˜\n';
                prompt += '- æœ€å¤šè§£æ 20 å€‹äº‹ä»¶\n\n';

                var requestBody;

                if (activeTab === 'text' || activeTab === 'file') {
                    prompt += '\n\næ™‚ç¨‹è¡¨å…§å®¹ï¼š\n' + scheduleText;
                    requestBody = {
                        contents: [{ parts: [{ text: prompt }] }],
                        generationConfig: { temperature: 0.2, topK: 40, topP: 0.95 }
                    };
                } else {
                    var parts = [{ text: prompt }];
                    for (var i = 0; i < uploadedImagesArray.length; i++) {
                        parts.push({ inline_data: { mime_type: "image/jpeg", data: uploadedImagesArray[i] } });
                    }
                    requestBody = {
                        contents: [{ parts: parts }],
                        generationConfig: { temperature: 0.2, topK: 40, topP: 0.95 }
                    };
                }

                var response = await fetch('https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=' + apiKey, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(requestBody)
                });

                if (!response.ok) {
                    var errorData = await response.json();
                    throw new Error(errorData.error && errorData.error.message ? errorData.error.message : 'è§£æå¤±æ•—');
                }

                var data = await response.json();
                var resultText = data.candidates[0].content.parts[0].text;
                var jsonText = resultText.replace(/```json\n?/g, '').replace(/```\n?/g, '').trim();
                var result = JSON.parse(jsonText);

                if (!result.events || result.events.length === 0) {
                    throw new Error('æœªèƒ½è§£æå‡ºä»»ä½•äº‹ä»¶');
                }

                parsedEvents = result.events;
                displayEventsPreview(parsedEvents);
                showStatus('âœ… æˆåŠŸè§£æ ' + parsedEvents.length + ' å€‹äº‹ä»¶ï¼', 'success');
                document.getElementById('importButtonsContainer').style.display = 'flex';

            } catch (error) {
                console.error('è§£æéŒ¯èª¤:', error);
                showStatus('âŒ è§£æå¤±æ•—ï¼š' + error.message, 'error');
            } finally {
                document.getElementById('btnText').style.display = 'flex';
                document.getElementById('btnLoading').style.display = 'none';
            }
        }

        // ========================================
        // é¡¯ç¤ºè§£æçµæœé è¦½
        // ========================================
        function displayEventsPreview(events) {
            var previewDiv = document.getElementById('eventsPreview');
            
            events.sort(function(a, b) {
                return new Date(a.startDateTime) - new Date(b.startDateTime);
            });
            
            var html = '<h3 style="margin-bottom: 20px; color: #667eea;">ğŸ“‹ è§£æçµæœé è¦½</h3>';
            
            for (var i = 0; i < events.length; i++) {
                var event = events[i];
                var startDate = new Date(event.startDateTime);
                var endDate = new Date(event.endDateTime);
                var duration = Math.round((endDate - startDate) / (1000 * 60));
                
                html += '<div class="event-item" id="event_' + i + '">';
                html += '<div style="display: flex; justify-content: space-between; align-items: flex-start;">';
                html += '<div class="event-title" style="flex: 1;">' + (i + 1) + '. ' + event.title + '</div>';
                html += '<button class="btn-delete-event" onclick="deleteEvent(' + i + ')">ğŸ—‘ï¸ åˆªé™¤</button>';
                html += '</div>';
                
                html += '<div class="event-time-block">';
                html += '<div style="margin-bottom: 12px;">';
                html += '<label style="display: block; font-weight: 600; color: #667eea; margin-bottom: 5px;">ğŸ“… é–‹å§‹æ™‚é–“</label>';
                html += '<div style="display: flex; gap: 10px;">';
                html += '<input type="date" id="startDate_' + i + '" value="' + startDate.toISOString().split('T')[0] + '" style="flex: 1; padding: 8px; border: 2px solid #e0e0e0; border-radius: 8px;" onchange="updateEventDateTime(' + i + ')">';
                html += '<input type="time" id="startTime_' + i + '" value="' + formatTime(startDate) + '" style="flex: 1; padding: 8px; border: 2px solid #e0e0e0; border-radius: 8px;" onchange="updateEventDateTime(' + i + ')">';
                html += '</div></div>';
                
                html += '<div style="margin-bottom: 12px;">';
                html += '<label style="display: block; font-weight: 600; color: #667eea; margin-bottom: 5px;">ğŸ çµæŸæ™‚é–“</label>';
                html += '<div style="display: flex; gap: 10px;">';
                html += '<input type="date" id="endDate_' + i + '" value="' + endDate.toISOString().split('T')[0] + '" style="flex: 1; padding: 8px; border: 2px solid #e0e0e0; border-radius: 8px;" onchange="updateEventDateTime(' + i + ')">';
                html += '<input type="time" id="endTime_' + i + '" value="' + formatTime(endDate) + '" style="flex: 1; padding: 8px; border: 2px solid #e0e0e0; border-radius: 8px;" onchange="updateEventDateTime(' + i + ')">';
                html += '</div>';
                html += '<div style="color: #999; font-size: 0.85em; margin-top: 5px;">æ™‚é•·: <span id="duration_' + i + '">' + duration + '</span> åˆ†é˜</div>';
                html += '</div></div>';
                
                if (event.location) {
                    html += '<div class="event-location">ğŸ“ ' + event.location + '</div>';
                }
                if (event.description) {
                    html += '<div style="color: #666; font-size: 0.9em; margin-top: 10px;">' + event.description + '</div>';
                }
                
                html += '<div class="additional-notes-section">';
                html += '<label class="additional-notes-label">âœï¸ è£œå……èªªæ˜ï¼ˆå¯é¸ï¼‰</label>';
                html += '<textarea class="additional-notes-input" id="additionalNotes_' + i + '" placeholder="æ”œå¸¶ç­†é›»ã€äº‹å‰æº–å‚™è³‡æ–™..." rows="2"></textarea>';
                html += '</div></div>';
            }
            
            previewDiv.innerHTML = html;
            previewDiv.classList.add('show');
        }

        function formatTime(date) {
            return String(date.getHours()).padStart(2, '0') + ':' + String(date.getMinutes()).padStart(2, '0');
        }

        function deleteEvent(index) {
            var eventElement = document.getElementById('event_' + index);
            if (eventElement && confirm('ç¢ºå®šè¦åˆªé™¤é€™å€‹äº‹ä»¶å—ï¼Ÿ')) {
                eventElement.classList.add('deleted');
                eventElement.dataset.deleted = 'true';
            }
        }

        function updateEventDateTime(index) {
            var startDateInput = document.getElementById('startDate_' + index);
            var startTimeInput = document.getElementById('startTime_' + index);
            var endDateInput = document.getElementById('endDate_' + index);
            var endTimeInput = document.getElementById('endTime_' + index);
            var durationSpan = document.getElementById('duration_' + index);
            
            if (startDateInput && startTimeInput && endDateInput && endTimeInput) {
                var startDateTime = new Date(startDateInput.value + 'T' + startTimeInput.value);
                var endDateTime = new Date(endDateInput.value + 'T' + endTimeInput.value);
                
                if (parsedEvents[index]) {
                    parsedEvents[index].startDateTime = startDateTime.toISOString();
                    parsedEvents[index].endDateTime = endDateTime.toISOString();
                }
                
                var duration = Math.round((endDateTime - startDateTime) / (1000 * 60));
                if (durationSpan) { durationSpan.textContent = duration; }
            }
        }

        // ========================================
        // Google Calendar æ•´åˆ
        // ========================================
        async function addToGoogleCalendar() {
            if (!isLocalServerEnvironment()) {
                showServerGuideModal();
                return;
            }
            
            if (parsedEvents.length === 0) {
                showStatus('âŒ æ²’æœ‰å¯åŒ¯å…¥çš„äº‹ä»¶', 'error');
                return;
            }

            if (!accessToken) {
                showStatus('âŒ è«‹å…ˆæˆæ¬Šå­˜å– Google æ—¥æ›†', 'error');
                return;
            }

            showStatus('ğŸš€ æ­£åœ¨åŒ¯å…¥äº‹ä»¶...', 'info');
            var successCount = 0;
            var reminders = getSelectedReminders();

            for (var i = 0; i < parsedEvents.length; i++) {
                var eventElement = document.getElementById('event_' + i);
                if (eventElement && eventElement.dataset.deleted === 'true') continue;
                
                var event = parsedEvents[i];
                var startDateInput = document.getElementById('startDate_' + i);
                var startTimeInput = document.getElementById('startTime_' + i);
                var endDateInput = document.getElementById('endDate_' + i);
                var endTimeInput = document.getElementById('endTime_' + i);
                
                var startDateTime = startDateInput && startTimeInput ? 
                    new Date(startDateInput.value + 'T' + startTimeInput.value) : new Date(event.startDateTime);
                var endDateTime = endDateInput && endTimeInput ? 
                    new Date(endDateInput.value + 'T' + endTimeInput.value) : new Date(event.endDateTime);

                var additionalNotesInput = document.getElementById('additionalNotes_' + i);
                var finalDescription = event.description || '';
                if (additionalNotesInput && additionalNotesInput.value.trim()) {
                    finalDescription += '\n\nã€è£œå……èªªæ˜ã€‘\n' + additionalNotesInput.value.trim();
                }

                var reminderOverrides = reminders.map(function(r) { return { method: 'popup', minutes: r }; });

                var calendarEvent = {
                    summary: event.title,
                    location: event.location || '',
                    description: finalDescription,
                    start: { dateTime: startDateTime.toISOString(), timeZone: Intl.DateTimeFormat().resolvedOptions().timeZone },
                    end: { dateTime: endDateTime.toISOString(), timeZone: Intl.DateTimeFormat().resolvedOptions().timeZone },
                    reminders: { useDefault: false, overrides: reminderOverrides }
                };

                try {
                    await gapi.client.calendar.events.insert({ calendarId: 'primary', resource: calendarEvent });
                    successCount++;
                } catch (error) {
                    console.error('å»ºç«‹äº‹ä»¶å¤±æ•—:', event.title, error);
                }
            }

            hideStatus();
            showResultModal(successCount, 0, [], reminders);
        }

        function showResultModal(successCount) {
            document.getElementById('successCountDisplay').textContent = successCount;
            document.getElementById('resultModal').classList.add('show');
        }

        function closeResultModal() { document.getElementById('resultModal').classList.remove('show'); }
        function openGoogleCalendar() { window.open('https://calendar.google.com', '_blank'); closeResultModal(); }
        
        function isLocalServerEnvironment() {
            var protocol = window.location.protocol;
            var hostname = window.location.hostname;
            if (protocol === 'file:') return false;
            if (protocol === 'http:' && (hostname === '127.0.0.1' || hostname === 'localhost')) return true;
            if (protocol === 'https:') return true;
            return false;
        }
        
        function showServerGuideModal() { document.getElementById('serverGuideModal').style.display = 'flex'; }
        function closeServerGuideModal() { document.getElementById('serverGuideModal').style.display = 'none'; }

        // ========================================
        // ICS æª”æ¡ˆç”Ÿæˆèˆ‡ä¸‹è¼‰
        // ========================================
        function downloadICS() {
            if (parsedEvents.length === 0) {
                showStatus('âŒ æ²’æœ‰å¯åŒ¯å‡ºçš„äº‹ä»¶', 'error');
                return;
            }

            var icsContent = 'BEGIN:VCALENDAR\nVERSION:2.0\nPRODID:-//Workshop Calendar Helper//EN\nCALSCALE:GREGORIAN\n';
            var reminders = getSelectedReminders();

            for (var i = 0; i < parsedEvents.length; i++) {
                var eventElement = document.getElementById('event_' + i);
                if (eventElement && eventElement.dataset.deleted === 'true') continue;

                var event = parsedEvents[i];
                var startDateInput = document.getElementById('startDate_' + i);
                var startTimeInput = document.getElementById('startTime_' + i);
                var endDateInput = document.getElementById('endDate_' + i);
                var endTimeInput = document.getElementById('endTime_' + i);
                
                var startDateTime = startDateInput && startTimeInput ? 
                    new Date(startDateInput.value + 'T' + startTimeInput.value) : new Date(event.startDateTime);
                var endDateTime = endDateInput && endTimeInput ? 
                    new Date(endDateInput.value + 'T' + endTimeInput.value) : new Date(event.endDateTime);

                var uid = 'workshop-' + i + '-' + Date.now() + '@calendar-helper.local';

                icsContent += 'BEGIN:VEVENT\n';
                icsContent += 'UID:' + uid + '\n';
                icsContent += 'DTSTAMP:' + formatICSDate(new Date()) + '\n';
                icsContent += 'DTSTART:' + formatICSDate(startDateTime) + '\n';
                icsContent += 'DTEND:' + formatICSDate(endDateTime) + '\n';
                icsContent += 'SUMMARY:' + escapeICSText(event.title) + '\n';
                if (event.location) icsContent += 'LOCATION:' + escapeICSText(event.location) + '\n';
                if (event.description) icsContent += 'DESCRIPTION:' + escapeICSText(event.description) + '\n';

                for (var j = 0; j < reminders.length; j++) {
                    icsContent += 'BEGIN:VALARM\nTRIGGER:-PT' + reminders[j] + 'M\nACTION:DISPLAY\nDESCRIPTION:ç ”ç¿’æé†’\nEND:VALARM\n';
                }
                icsContent += 'END:VEVENT\n';
            }

            icsContent += 'END:VCALENDAR';

            var blob = new Blob([icsContent], { type: 'text/calendar;charset=utf-8' });
            var now = new Date();
            var filename = 'ç ”ç¿’è¡Œäº‹æ›†_' + now.getFullYear() + String(now.getMonth() + 1).padStart(2, '0') + String(now.getDate()).padStart(2, '0') + '.ics';

            var link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = filename;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);

            showStatus('âœ… ICS æª”æ¡ˆå·²ä¸‹è¼‰ï¼š' + filename, 'success');
            setTimeout(hideStatus, 3000);
        }

        function formatICSDate(date) {
            return date.getFullYear() + String(date.getMonth() + 1).padStart(2, '0') + String(date.getDate()).padStart(2, '0') + 'T' +
                   String(date.getHours()).padStart(2, '0') + String(date.getMinutes()).padStart(2, '0') + String(date.getSeconds()).padStart(2, '0');
        }

        function escapeICSText(text) {
            if (!text) return '';
            return text.replace(/\\/g, '\\\\').replace(/;/g, '\\;').replace(/,/g, '\\,').replace(/\n/g, '\\n').replace(/\r/g, '');
        }

        function downloadICSFromModal() { downloadICS(); }

        function getSelectedReminders() {
            var reminders = [];
            document.querySelectorAll('.reminder-options input[type="checkbox"]').forEach(function(checkbox) {
                if (checkbox.checked) reminders.push(parseInt(checkbox.value));
            });
            return reminders;
        }

        // ========================================
        // é é¢è¼‰å…¥å®Œæˆ
        // ========================================
        window.addEventListener('DOMContentLoaded', function() {
            console.log('âœ… ç ”ç¿’å·¥å…·åˆå§‹åŒ–å®Œæˆï¼ˆæ”¯æ´æ°‘åœ‹å¹´è½‰æ›ï¼‰');
            
            var remind60Checkbox = document.querySelector('#remind60');
            if (remind60Checkbox) {
                remind60Checkbox.checked = true;
                remind60Checkbox.parentElement.classList.add('checked');
            }
            
            gapiLoaded();
            gisLoaded();
            
            setTimeout(function() {
                var serverStatusText = document.getElementById('serverStatusText');
                if (serverStatusText) {
                    if (isLocalServerEnvironment()) {
                        serverStatusText.textContent = 'âœ… ç’°å¢ƒå°±ç·’';
                        serverStatusText.style.color = '#10b981';
                    } else {
                        serverStatusText.textContent = 'âš ï¸ éœ€è¦æœ¬åœ°ä¼ºæœå™¨';
                        serverStatusText.style.color = '#f59e0b';
                    }
                }
            }, 500);
        });
    </script>

    <!-- ğŸš€ é–‹æ©Ÿå‹•ç•«æ§åˆ¶è…³æœ¬ -->
    <script>
        // é–‹æ©Ÿå‹•ç•«æ§åˆ¶
        (function() {
            const splash = document.getElementById('splashScreen');
            
            // ç¢ºä¿å‹•ç•«è‡³å°‘é¡¯ç¤º 3.5 ç§’ï¼ˆè®“é€²åº¦æ¢è·‘å®Œï¼‰
            const minDisplayTime = 3500;
            const startTime = Date.now();
            
            function hideSplash() {
                const elapsed = Date.now() - startTime;
                const remaining = Math.max(0, minDisplayTime - elapsed);
                
                setTimeout(() => {
                    splash.classList.add('hide');
                    // å‹•ç•«çµæŸå¾Œç§»é™¤å…ƒç´ 
                    setTimeout(() => {
                        splash.style.display = 'none';
                    }, 800);
                }, remaining);
            }
            
            // é é¢è¼‰å…¥å®Œæˆå¾Œéš±è—
            if (document.readyState === 'complete') {
                hideSplash();
            } else {
                window.addEventListener('load', hideSplash);
            }
        })();
    </script>
</body>
</html>
